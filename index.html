<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Video Extract Pro - yt-dlp Command Generator</title>
    <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;500;600;700&family=Space+Grotesk:wght@400;500;600;700&display=swap" rel="stylesheet">
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <style>
        :root {
            --bg-base: #0c0c10;
            --bg-surface: #14141a;
            --bg-elevated: #1c1c24;
            --bg-hover: #24242e;
            --accent-blue: #3b82f6;
            --accent-cyan: #06b6d4;
            --accent-green: #22c55e;
            --accent-yellow: #eab308;
            --accent-orange: #f97316;
            --accent-red: #ef4444;
            --accent-purple: #a855f7;
            --text-primary: #f4f4f5;
            --text-secondary: #a1a1aa;
            --text-muted: #71717a;
            --border: #27272a;
            --border-focus: #3b82f6;
            --font-display: 'Space Grotesk', sans-serif;
            --font-mono: 'JetBrains Mono', monospace;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: var(--font-display);
            background: var(--bg-base);
            color: var(--text-primary);
            min-height: 100vh;
            line-height: 1.5;
        }

        ::-webkit-scrollbar { width: 6px; height: 6px; }
        ::-webkit-scrollbar-track { background: var(--bg-surface); }
        ::-webkit-scrollbar-thumb { background: var(--border); border-radius: 3px; }
        ::-webkit-scrollbar-thumb:hover { background: var(--text-muted); }

        input, select, textarea, button {
            font-family: inherit;
        }

        .app {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }

        @keyframes slideIn {
            from { opacity: 0; transform: translateX(-10px); }
            to { opacity: 1; transform: translateX(0); }
        }

        .animate-in {
            animation: fadeIn 0.3s ease-out;
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useCallback, useMemo } = React;

        // ============== ICONS ==============
        const Icons = {
            Download: () => <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="7 10 12 15 17 10"/><line x1="12" y1="15" x2="12" y2="3"/></svg>,
            Zap: () => <svg width="18" height="18" viewBox="0 0 24 24" fill="currentColor"><path d="M13 2L3 14h9l-1 8 10-12h-9l1-8z"/></svg>,
            Settings: () => <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><circle cx="12" cy="12" r="3"/><path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z"/></svg>,
            Clock: () => <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><circle cx="12" cy="12" r="10"/><polyline points="12 6 12 12 16 14"/></svg>,
            Copy: () => <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><rect x="9" y="9" width="13" height="13" rx="2" ry="2"/><path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"/></svg>,
            Check: () => <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><polyline points="20 6 9 17 4 12"/></svg>,
            Plus: () => <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><line x1="12" y1="5" x2="12" y2="19"/><line x1="5" y1="12" x2="19" y2="12"/></svg>,
            Trash: () => <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><polyline points="3 6 5 6 21 6"/><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"/></svg>,
            Edit: () => <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"/><path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"/></svg>,
            Star: () => <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor"><polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"/></svg>,
            StarOutline: () => <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"/></svg>,
            Globe: () => <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><circle cx="12" cy="12" r="10"/><line x1="2" y1="12" x2="22" y2="12"/><path d="M12 2a15.3 15.3 0 0 1 4 10 15.3 15.3 0 0 1-4 10 15.3 15.3 0 0 1-4-10 15.3 15.3 0 0 1 4-10z"/></svg>,
            Terminal: () => <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><polyline points="4 17 10 11 4 5"/><line x1="12" y1="19" x2="20" y2="19"/></svg>,
            Layers: () => <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><polygon points="12 2 2 7 12 12 22 7 12 2"/><polyline points="2 17 12 22 22 17"/><polyline points="2 12 12 17 22 12"/></svg>,
            ArrowRight: () => <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><line x1="5" y1="12" x2="19" y2="12"/><polyline points="12 5 19 12 12 19"/></svg>,
            Video: () => <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><rect x="2" y="4" width="20" height="16" rx="2"/><path d="M10 9l5 3-5 3V9z"/></svg>,
            Music: () => <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="M9 18V5l12-2v13"/><circle cx="6" cy="18" r="3"/><circle cx="18" cy="16" r="3"/></svg>,
            List: () => <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><line x1="8" y1="6" x2="21" y2="6"/><line x1="8" y1="12" x2="21" y2="12"/><line x1="8" y1="18" x2="21" y2="18"/><line x1="3" y1="6" x2="3.01" y2="6"/><line x1="3" y1="12" x2="3.01" y2="12"/><line x1="3" y1="18" x2="3.01" y2="18"/></svg>,
            History: () => <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="M3 3v5h5"/><path d="M3.05 13A9 9 0 1 0 6 5.3L3 8"/><path d="M12 7v5l4 2"/></svg>,
            Code: () => <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><polyline points="16 18 22 12 16 6"/><polyline points="8 6 2 12 8 18"/></svg>,
            Folder: () => <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="M22 19a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h5l2 3h9a2 2 0 0 1 2 2z"/></svg>,
            ChevronDown: () => <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><polyline points="6 9 12 15 18 9"/></svg>,
            X: () => <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><line x1="18" y1="6" x2="6" y2="18"/><line x1="6" y1="6" x2="18" y2="18"/></svg>,
            Sparkles: () => <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="M12 3l1.5 4.5L18 9l-4.5 1.5L12 15l-1.5-4.5L6 9l4.5-1.5L12 3z"/><path d="M5 19l.5 1.5L7 21l-1.5.5L5 23l-.5-1.5L3 21l1.5-.5L5 19z"/></svg>,
            Brain: () => <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="M12 2a4 4 0 0 0-4 4v1a3 3 0 0 0-3 3v1a3 3 0 0 0 3 3h1v5a2 2 0 0 0 2 2h2a2 2 0 0 0 2-2v-5h1a3 3 0 0 0 3-3v-1a3 3 0 0 0-3-3V6a4 4 0 0 0-4-4z"/><circle cx="9" cy="9" r="1"/><circle cx="15" cy="9" r="1"/></svg>,
            Wand: () => <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="M15 4V2"/><path d="M15 16v-2"/><path d="M8 9h2"/><path d="M20 9h2"/><path d="M17.8 11.8L19 13"/><path d="M15 9h0"/><path d="M17.8 6.2L19 5"/><path d="M3 21l9-9"/><path d="M12.2 6.2L11 5"/></svg>,
            Upload: () => <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="17 8 12 3 7 8"/><line x1="12" y1="3" x2="12" y2="15"/></svg>,
            Play: () => <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><polygon points="5 3 19 12 5 21 5 3"/></svg>,
            Scissors: () => <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><circle cx="6" cy="6" r="3"/><circle cx="6" cy="18" r="3"/><line x1="20" y1="4" x2="8.12" y2="15.88"/><line x1="14.47" y1="14.48" x2="20" y2="20"/><line x1="8.12" y1="8.12" x2="12" y2="12"/></svg>,
            TrendingUp: () => <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><polyline points="23 6 13.5 15.5 8.5 10.5 1 18"/><polyline points="17 6 23 6 23 12"/></svg>,
            Users: () => <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"/><circle cx="9" cy="7" r="4"/><path d="M23 21v-2a4 4 0 0 0-3-3.87"/><path d="M16 3.13a4 4 0 0 1 0 7.75"/></svg>,
            FileText: () => <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/><polyline points="14 2 14 8 20 8"/><line x1="16" y1="13" x2="8" y2="13"/><line x1="16" y1="17" x2="8" y2="17"/></svg>,
            AlertCircle: () => <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><circle cx="12" cy="12" r="10"/><line x1="12" y1="8" x2="12" y2="12"/><line x1="12" y1="16" x2="12.01" y2="16"/></svg>,
            Loader: () => <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" className="animate-spin"><line x1="12" y1="2" x2="12" y2="6"/><line x1="12" y1="18" x2="12" y2="22"/><line x1="4.93" y1="4.93" x2="7.76" y2="7.76"/><line x1="16.24" y1="16.24" x2="19.07" y2="19.07"/><line x1="2" y1="12" x2="6" y2="12"/><line x1="18" y1="12" x2="22" y2="12"/><line x1="4.93" y1="19.07" x2="7.76" y2="16.24"/><line x1="16.24" y1="7.76" x2="19.07" y2="4.93"/></svg>,
            // Pro Features Icons
            Type: () => <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><polyline points="4 7 4 4 20 4 20 7"/><line x1="9" y1="20" x2="15" y2="20"/><line x1="12" y1="4" x2="12" y2="20"/></svg>,
            Palette: () => <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><circle cx="13.5" cy="6.5" r="2.5"/><circle cx="17.5" cy="10.5" r="2.5"/><circle cx="8.5" cy="7.5" r="2.5"/><circle cx="6.5" cy="12.5" r="2.5"/><path d="M12 2C6.5 2 2 6.5 2 12s4.5 10 10 10c.926 0 1.648-.746 1.648-1.688 0-.437-.18-.835-.437-1.125-.29-.289-.438-.652-.438-1.125a1.64 1.64 0 0 1 1.668-1.668h1.996c3.051 0 5.555-2.503 5.555-5.555C21.965 6.012 17.461 2 12 2z"/></svg>,
            Image: () => <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><rect x="3" y="3" width="18" height="18" rx="2" ry="2"/><circle cx="8.5" cy="8.5" r="1.5"/><polyline points="21 15 16 10 5 21"/></svg>,
            Crop: () => <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="M6.13 1L6 16a2 2 0 0 0 2 2h15"/><path d="M1 6.13L16 6a2 2 0 0 1 2 2v15"/></svg>,
            Maximize: () => <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="M8 3H5a2 2 0 0 0-2 2v3m18 0V5a2 2 0 0 0-2-2h-3m0 18h3a2 2 0 0 0 2-2v-3M3 16v3a2 2 0 0 0 2 2h3"/></svg>,
            Monitor: () => <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><rect x="2" y="3" width="20" height="14" rx="2" ry="2"/><line x1="8" y1="21" x2="16" y2="21"/><line x1="12" y1="17" x2="12" y2="21"/></svg>,
            Smartphone: () => <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><rect x="5" y="2" width="14" height="20" rx="2" ry="2"/><line x1="12" y1="18" x2="12.01" y2="18"/></svg>,
            Square: () => <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><rect x="3" y="3" width="18" height="18" rx="2" ry="2"/></svg>,
            Award: () => <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><circle cx="12" cy="8" r="7"/><polyline points="8.21 13.89 7 23 12 20 17 23 15.79 13.88"/></svg>,
            Share2: () => <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><circle cx="18" cy="5" r="3"/><circle cx="6" cy="12" r="3"/><circle cx="18" cy="19" r="3"/><line x1="8.59" y1="13.51" x2="15.42" y2="17.49"/><line x1="15.41" y1="6.51" x2="8.59" y2="10.49"/></svg>,
            Film: () => <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><rect x="2" y="2" width="20" height="20" rx="2.18" ry="2.18"/><line x1="7" y1="2" x2="7" y2="22"/><line x1="17" y1="2" x2="17" y2="22"/><line x1="2" y1="12" x2="22" y2="12"/><line x1="2" y1="7" x2="7" y2="7"/><line x1="2" y1="17" x2="7" y2="17"/><line x1="17" y1="17" x2="22" y2="17"/><line x1="17" y1="7" x2="22" y2="7"/></svg>,
            Eye: () => <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"/><circle cx="12" cy="12" r="3"/></svg>,
            RotateCw: () => <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><polyline points="23 4 23 10 17 10"/><path d="M20.49 15a9 9 0 1 1-2.12-9.36L23 10"/></svg>,
            Sliders: () => <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><line x1="4" y1="21" x2="4" y2="14"/><line x1="4" y1="10" x2="4" y2="3"/><line x1="12" y1="21" x2="12" y2="12"/><line x1="12" y1="8" x2="12" y2="3"/><line x1="20" y1="21" x2="20" y2="16"/><line x1="20" y1="12" x2="20" y2="3"/><line x1="1" y1="14" x2="7" y2="14"/><line x1="9" y1="8" x2="15" y2="8"/><line x1="17" y1="16" x2="23" y2="16"/></svg>,
            Grid: () => <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><rect x="3" y="3" width="7" height="7"/><rect x="14" y="3" width="7" height="7"/><rect x="14" y="14" width="7" height="7"/><rect x="3" y="14" width="7" height="7"/></svg>,
            Layout: () => <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><rect x="3" y="3" width="18" height="18" rx="2" ry="2"/><line x1="3" y1="9" x2="21" y2="9"/><line x1="9" y1="21" x2="9" y2="9"/></svg>,
            FileDown: () => <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/><polyline points="14 2 14 8 20 8"/><line x1="12" y1="18" x2="12" y2="12"/><polyline points="9 15 12 18 15 15"/></svg>,
            Package: () => <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><line x1="16.5" y1="9.4" x2="7.5" y2="4.21"/><path d="M21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16z"/><polyline points="3.27 6.96 12 12.01 20.73 6.96"/><line x1="12" y1="22.08" x2="12" y2="12"/></svg>,
        };

        // ============== DEFAULT PRESETS ==============
        const defaultPresets = [
            {
                id: 'high-quality',
                name: 'High Quality Video',
                isDefault: true,
                quality: '1080',
                format: 'bestvideo[height<=1080]+bestaudio/best',
                outputTemplate: '%(title)s.%(ext)s',
                embedChapters: true,
                embedMetadata: true,
                embedThumbnail: false,
                extractAudio: false,
                audioFormat: 'mp3',
                audioQuality: '0',
            },
            {
                id: 'audio-only',
                name: 'Audio Only (Music)',
                isDefault: false,
                quality: 'best',
                format: 'bestaudio',
                outputTemplate: '%(title)s.%(ext)s',
                embedChapters: false,
                embedMetadata: true,
                embedThumbnail: true,
                extractAudio: true,
                audioFormat: 'mp3',
                audioQuality: '0',
            },
            {
                id: 'mobile-friendly',
                name: 'Mobile Friendly',
                isDefault: false,
                quality: '720',
                format: 'bestvideo[height<=720]+bestaudio/best',
                outputTemplate: '%(title)s.%(ext)s',
                embedChapters: true,
                embedMetadata: false,
                embedThumbnail: false,
                extractAudio: false,
                audioFormat: 'mp3',
                audioQuality: '5',
            },
            {
                id: 'playlist-archive',
                name: 'Playlist Archive',
                isDefault: false,
                quality: '1080',
                format: 'bestvideo[height<=1080]+bestaudio/best',
                outputTemplate: '%(playlist_index)s - %(title)s.%(ext)s',
                embedChapters: true,
                embedMetadata: true,
                embedThumbnail: true,
                extractAudio: false,
                audioFormat: 'mp3',
                audioQuality: '0',
            },
        ];

        // ============== UTILITY FUNCTIONS ==============
        const detectPlatform = (url) => {
            if (!url) return null;
            if (url.includes('youtube.com') || url.includes('youtu.be')) return 'youtube';
            if (url.includes('vimeo.com')) return 'vimeo';
            if (url.includes('twitter.com') || url.includes('x.com')) return 'twitter';
            if (url.includes('tiktok.com')) return 'tiktok';
            if (url.includes('instagram.com')) return 'instagram';
            if (url.includes('twitch.tv')) return 'twitch';
            return 'other';
        };

        const detectUrlType = (url) => {
            if (!url) return null;
            if (url.includes('/playlist') || url.includes('list=')) return 'playlist';
            if (url.includes('/shorts/')) return 'shorts';
            if (url.includes('@') && url.includes('/videos')) return 'channel';
            return 'video';
        };

        const generateCommand = (url, preset, extraOptions = {}) => {
            if (!url) return '';
            
            let cmd = 'yt-dlp';
            
            // Format selection
            if (preset.extractAudio) {
                cmd += ` -x --audio-format ${preset.audioFormat}`;
                if (preset.audioQuality !== '0') {
                    cmd += ` --audio-quality ${preset.audioQuality}`;
                }
            } else {
                cmd += ` -f "${preset.format}"`;
            }
            
            // Output template
            cmd += ` -o "${preset.outputTemplate}"`;
            
            // Embed options
            if (preset.embedChapters) cmd += ' --embed-chapters';
            if (preset.embedMetadata) cmd += ' --embed-metadata';
            if (preset.embedThumbnail) cmd += ' --embed-thumbnail';
            
            // Extra options
            if (extraOptions.downloadSubtitles) cmd += ' --write-subs --sub-langs "en.*"';
            if (extraOptions.limitRate) cmd += ` --limit-rate ${extraOptions.limitRate}`;
            if (extraOptions.outputPath) cmd += ` -P "${extraOptions.outputPath}"`;
            if (extraOptions.cookiesFile) cmd += ` --cookies "${extraOptions.cookiesFile}"`;
            if (extraOptions.sponsorBlock) cmd += ' --sponsorblock-remove all';
            if (extraOptions.noPlaylist) cmd += ' --no-playlist';
            if (extraOptions.playlistItems) cmd += ` --playlist-items "${extraOptions.playlistItems}"`;
            
            // URL
            cmd += ` "${url}"`;
            
            return cmd;
        };

        // ============== API HELPERS & CONSTANTS ==============
        const getApiBase = () => localStorage.getItem('vep-api-url') || 'http://localhost:8001/api/v1';
        const getDownloadDir = () => localStorage.getItem('vep-download-dir') || '';

        // Caption Style Types
        const CAPTION_STYLE_TYPES = [
            { value: 'karaoke', label: 'Karaoke', description: 'Word-by-word highlight as spoken' },
            { value: 'bounce', label: 'Bounce', description: 'Words bounce in with animation' },
            { value: 'typewriter', label: 'Typewriter', description: 'Characters appear one by one' },
            { value: 'fade', label: 'Fade', description: 'Smooth fade in/out transitions' },
            { value: 'static', label: 'Static', description: 'No animation, plain captions' },
        ];

        // Caption Positions
        const CAPTION_POSITIONS = [
            { value: 'top', label: 'Top' },
            { value: 'center', label: 'Center' },
            { value: 'bottom', label: 'Bottom' },
        ];

        // Logo Positions
        const LOGO_POSITIONS = [
            { value: 'top_left', label: 'Top Left' },
            { value: 'top_right', label: 'Top Right' },
            { value: 'bottom_left', label: 'Bottom Left' },
            { value: 'bottom_right', label: 'Bottom Right' },
            { value: 'center', label: 'Center' },
        ];

        // Aspect Ratios
        const ASPECT_RATIOS = [
            { value: '9:16', label: '9:16', description: 'TikTok, Reels, Shorts', icon: 'Smartphone', width: 1080, height: 1920 },
            { value: '1:1', label: '1:1', description: 'Instagram Feed', icon: 'Square', width: 1080, height: 1080 },
            { value: '16:9', label: '16:9', description: 'YouTube, Widescreen', icon: 'Monitor', width: 1920, height: 1080 },
            { value: '4:3', label: '4:3', description: 'Classic TV', icon: 'Monitor', width: 1440, height: 1080 },
            { value: '4:5', label: '4:5', description: 'Instagram Portrait', icon: 'Smartphone', width: 1080, height: 1350 },
        ];

        // Tracking Modes
        const TRACKING_MODES = [
            { value: 'speaker', label: 'Speaker Focus', description: 'Follow the speaking person' },
            { value: 'action', label: 'Action Focus', description: 'Follow main action in scene' },
            { value: 'center', label: 'Center Crop', description: 'Always crop from center' },
            { value: 'manual', label: 'Manual', description: 'Set keyframes manually' },
        ];

        // API fetch helper
        const apiFetch = async (endpoint, options = {}) => {
            const apiBase = getApiBase();
            const response = await fetch(`${apiBase}${endpoint}`, {
                ...options,
                headers: {
                    'Content-Type': 'application/json',
                    ...options.headers,
                },
            });
            if (!response.ok) {
                const err = await response.json().catch(() => ({ detail: 'Request failed' }));
                throw new Error(err.detail || 'Request failed');
            }
            return response.json();
        };

        // ============== COMPONENTS ==============
        
        // Toast notification
        const Toast = ({ message, type = 'success', onClose }) => {
            useEffect(() => {
                const timer = setTimeout(onClose, 3000);
                return () => clearTimeout(timer);
            }, [onClose]);
            
            const bgColor = type === 'success' ? 'var(--accent-green)' : type === 'error' ? 'var(--accent-red)' : 'var(--accent-blue)';
            
            return (
                <div style={{
                    position: 'fixed',
                    bottom: '24px',
                    right: '24px',
                    padding: '12px 20px',
                    background: bgColor,
                    borderRadius: '8px',
                    color: 'white',
                    fontWeight: '500',
                    fontSize: '14px',
                    display: 'flex',
                    alignItems: 'center',
                    gap: '8px',
                    boxShadow: '0 8px 32px rgba(0,0,0,0.4)',
                    zIndex: 1000,
                    animation: 'fadeIn 0.3s ease-out'
                }}>
                    <Icons.Check />
                    {message}
                </div>
            );
        };

        // Header
        const Header = ({ activeTab, setActiveTab }) => {
            const tabs = [
                { id: 'extract', label: 'Extract', icon: Icons.Download },
                { id: 'aianalysis', label: 'AI Analysis', icon: Icons.Brain },
                { id: 'profeatures', label: 'Pro Features', icon: Icons.Sparkles },
                { id: 'presets', label: 'Presets', icon: Icons.Layers },
                { id: 'converter', label: 'Timestamp Converter', icon: Icons.Clock },
                { id: 'history', label: 'History', icon: Icons.History },
            ];
            
            return (
                <header style={{
                    marginBottom: '24px',
                    paddingBottom: '20px',
                    borderBottom: '1px solid var(--border)'
                }}>
                    <div style={{
                        display: 'flex',
                        alignItems: 'center',
                        justifyContent: 'space-between',
                        marginBottom: '20px'
                    }}>
                        <div style={{ display: 'flex', alignItems: 'center', gap: '12px' }}>
                            <div style={{
                                width: '44px',
                                height: '44px',
                                borderRadius: '12px',
                                background: 'linear-gradient(135deg, var(--accent-blue) 0%, var(--accent-purple) 100%)',
                                display: 'flex',
                                alignItems: 'center',
                                justifyContent: 'center',
                                boxShadow: '0 4px 20px rgba(59,130,246,0.3)'
                            }}>
                                <Icons.Zap />
                            </div>
                            <div>
                                <h1 style={{
                                    fontSize: '24px',
                                    fontWeight: '700',
                                    letterSpacing: '-0.5px'
                                }}>Video Extract Pro</h1>
                                <p style={{
                                    fontSize: '13px',
                                    color: 'var(--text-muted)',
                                    fontFamily: 'var(--font-mono)'
                                }}>yt-dlp command generator</p>
                            </div>
                        </div>
                        <a 
                            href="https://github.com/yt-dlp/yt-dlp"
                            target="_blank"
                            rel="noopener noreferrer"
                            style={{
                                padding: '8px 16px',
                                background: 'var(--bg-elevated)',
                                border: '1px solid var(--border)',
                                borderRadius: '8px',
                                color: 'var(--text-secondary)',
                                textDecoration: 'none',
                                fontSize: '13px',
                                display: 'flex',
                                alignItems: 'center',
                                gap: '6px',
                                transition: 'all 0.2s'
                            }}
                        >
                            <Icons.Code />
                            yt-dlp docs
                        </a>
                    </div>
                    
                    <nav style={{
                        display: 'flex',
                        gap: '4px',
                        background: 'var(--bg-surface)',
                        padding: '4px',
                        borderRadius: '12px',
                        width: 'fit-content'
                    }}>
                        {tabs.map(tab => (
                            <button
                                key={tab.id}
                                onClick={() => setActiveTab(tab.id)}
                                style={{
                                    padding: '10px 20px',
                                    background: activeTab === tab.id ? 'var(--bg-elevated)' : 'transparent',
                                    border: 'none',
                                    borderRadius: '8px',
                                    color: activeTab === tab.id ? 'var(--text-primary)' : 'var(--text-secondary)',
                                    fontSize: '14px',
                                    fontWeight: '500',
                                    cursor: 'pointer',
                                    display: 'flex',
                                    alignItems: 'center',
                                    gap: '8px',
                                    transition: 'all 0.2s'
                                }}
                            >
                                <tab.icon />
                                {tab.label}
                            </button>
                        ))}
                    </nav>
                </header>
            );
        };

        // URL Input Section
        const URLInput = ({ url, setUrl, platform, urlType }) => (
            <div style={{
                background: 'var(--bg-surface)',
                borderRadius: '16px',
                padding: '24px',
                marginBottom: '20px',
                border: '1px solid var(--border)'
            }}>
                <div style={{
                    display: 'flex',
                    alignItems: 'center',
                    gap: '10px',
                    marginBottom: '16px'
                }}>
                    <Icons.Globe />
                    <h2 style={{ fontSize: '18px', fontWeight: '600' }}>Video URL</h2>
                </div>
                
                <div style={{
                    display: 'flex',
                    gap: '12px',
                    alignItems: 'stretch'
                }}>
                    <div style={{
                        flex: 1,
                        position: 'relative'
                    }}>
                        <input
                            type="text"
                            value={url}
                            onChange={(e) => setUrl(e.target.value)}
                            placeholder="https://youtube.com/watch?v=..."
                            style={{
                                width: '100%',
                                padding: '14px 16px',
                                paddingRight: platform ? '100px' : '16px',
                                background: 'var(--bg-elevated)',
                                border: '1px solid var(--border)',
                                borderRadius: '10px',
                                color: 'var(--text-primary)',
                                fontSize: '15px',
                                fontFamily: 'var(--font-mono)',
                                outline: 'none',
                                transition: 'border-color 0.2s'
                            }}
                            onFocus={(e) => e.target.style.borderColor = 'var(--border-focus)'}
                            onBlur={(e) => e.target.style.borderColor = 'var(--border)'}
                        />
                        {platform && (
                            <span style={{
                                position: 'absolute',
                                right: '12px',
                                top: '50%',
                                transform: 'translateY(-50%)',
                                padding: '4px 10px',
                                background: platform === 'youtube' ? 'rgba(239,68,68,0.15)' : 'rgba(59,130,246,0.15)',
                                color: platform === 'youtube' ? '#ef4444' : 'var(--accent-blue)',
                                borderRadius: '6px',
                                fontSize: '12px',
                                fontWeight: '500',
                                textTransform: 'capitalize'
                            }}>
                                {platform}
                            </span>
                        )}
                    </div>
                </div>
                
                <div style={{
                    display: 'flex',
                    gap: '8px',
                    marginTop: '12px',
                    flexWrap: 'wrap'
                }}>
                    <span style={{ fontSize: '13px', color: 'var(--text-muted)' }}>Supports:</span>
                    {['YouTube', 'Playlists', 'Shorts', 'Vimeo', 'Twitter', 'TikTok'].map(p => (
                        <span
                            key={p}
                            style={{
                                padding: '4px 10px',
                                background: 'var(--bg-elevated)',
                                borderRadius: '6px',
                                fontSize: '12px',
                                color: 'var(--text-secondary)',
                                border: '1px solid var(--border)'
                            }}
                        >
                            {p}
                        </span>
                    ))}
                </div>
            </div>
        );

        // Preset Card
        const PresetCard = ({ preset, isSelected, onSelect, onEdit, onDelete, onToggleDefault }) => (
            <div
                onClick={() => onSelect(preset)}
                style={{
                    background: isSelected ? 'rgba(59,130,246,0.1)' : 'var(--bg-surface)',
                    borderRadius: '12px',
                    padding: '16px',
                    border: isSelected ? '1px solid var(--accent-blue)' : '1px solid var(--border)',
                    cursor: 'pointer',
                    transition: 'all 0.2s'
                }}
            >
                <div style={{
                    display: 'flex',
                    justifyContent: 'space-between',
                    alignItems: 'start',
                    marginBottom: '12px'
                }}>
                    <div>
                        <h3 style={{ fontSize: '15px', fontWeight: '600', marginBottom: '4px' }}>
                            {preset.name}
                        </h3>
                        <div style={{ display: 'flex', gap: '6px', flexWrap: 'wrap' }}>
                            <span style={{
                                padding: '3px 8px',
                                background: preset.extractAudio ? 'rgba(168,85,247,0.15)' : 'rgba(34,197,94,0.15)',
                                color: preset.extractAudio ? 'var(--accent-purple)' : 'var(--accent-green)',
                                borderRadius: '4px',
                                fontSize: '11px',
                                fontWeight: '500'
                            }}>
                                {preset.extractAudio ? 'Audio' : preset.quality + 'p'}
                            </span>
                            {preset.isDefault && (
                                <span style={{
                                    padding: '3px 8px',
                                    background: 'rgba(234,179,8,0.15)',
                                    color: 'var(--accent-yellow)',
                                    borderRadius: '4px',
                                    fontSize: '11px',
                                    fontWeight: '500',
                                    display: 'flex',
                                    alignItems: 'center',
                                    gap: '4px'
                                }}>
                                    <Icons.Star /> Default
                                </span>
                            )}
                        </div>
                    </div>
                    <button
                        onClick={(e) => { e.stopPropagation(); onToggleDefault(preset.id); }}
                        style={{
                            background: 'none',
                            border: 'none',
                            color: preset.isDefault ? 'var(--accent-yellow)' : 'var(--text-muted)',
                            cursor: 'pointer',
                            padding: '4px'
                        }}
                    >
                        {preset.isDefault ? <Icons.Star /> : <Icons.StarOutline />}
                    </button>
                </div>
                
                <div style={{
                    fontFamily: 'var(--font-mono)',
                    fontSize: '12px',
                    color: 'var(--text-muted)',
                    marginBottom: '12px'
                }}>
                    Output: {preset.outputTemplate}
                </div>
                
                <div style={{ display: 'flex', gap: '6px', marginBottom: '12px', flexWrap: 'wrap' }}>
                    {preset.embedChapters && (
                        <span style={{
                            padding: '3px 8px',
                            background: 'rgba(34,197,94,0.1)',
                            color: 'var(--accent-green)',
                            borderRadius: '4px',
                            fontSize: '11px'
                        }}>Chapters</span>
                    )}
                    {preset.embedMetadata && (
                        <span style={{
                            padding: '3px 8px',
                            background: 'rgba(59,130,246,0.1)',
                            color: 'var(--accent-blue)',
                            borderRadius: '4px',
                            fontSize: '11px'
                        }}>Metadata</span>
                    )}
                    {preset.embedThumbnail && (
                        <span style={{
                            padding: '3px 8px',
                            background: 'rgba(168,85,247,0.1)',
                            color: 'var(--accent-purple)',
                            borderRadius: '4px',
                            fontSize: '11px'
                        }}>Thumbnail</span>
                    )}
                </div>
                
                <div style={{
                    display: 'flex',
                    gap: '8px'
                }}>
                    <button
                        onClick={(e) => { e.stopPropagation(); onEdit(preset); }}
                        style={{
                            flex: 1,
                            padding: '8px',
                            background: 'var(--bg-elevated)',
                            border: '1px solid var(--border)',
                            borderRadius: '8px',
                            color: 'var(--text-secondary)',
                            cursor: 'pointer',
                            display: 'flex',
                            alignItems: 'center',
                            justifyContent: 'center',
                            gap: '6px',
                            fontSize: '13px'
                        }}
                    >
                        <Icons.Edit /> Edit
                    </button>
                    <button
                        onClick={(e) => { e.stopPropagation(); onDelete(preset.id); }}
                        style={{
                            padding: '8px 12px',
                            background: 'rgba(239,68,68,0.1)',
                            border: '1px solid rgba(239,68,68,0.2)',
                            borderRadius: '8px',
                            color: 'var(--accent-red)',
                            cursor: 'pointer',
                            display: 'flex',
                            alignItems: 'center',
                            justifyContent: 'center'
                        }}
                    >
                        <Icons.Trash />
                    </button>
                </div>
            </div>
        );

        // Command Preview
        const CommandPreview = ({ command, onCopy, copied }) => (
            <div style={{
                background: 'var(--bg-surface)',
                borderRadius: '16px',
                padding: '24px',
                border: '1px solid var(--border)'
            }}>
                <div style={{
                    display: 'flex',
                    justifyContent: 'space-between',
                    alignItems: 'center',
                    marginBottom: '16px'
                }}>
                    <div style={{ display: 'flex', alignItems: 'center', gap: '10px' }}>
                        <Icons.Terminal />
                        <h2 style={{ fontSize: '18px', fontWeight: '600' }}>Generated Command</h2>
                    </div>
                    <button
                        onClick={onCopy}
                        style={{
                            padding: '8px 16px',
                            background: copied ? 'var(--accent-green)' : 'var(--accent-blue)',
                            border: 'none',
                            borderRadius: '8px',
                            color: 'white',
                            fontSize: '13px',
                            fontWeight: '500',
                            cursor: 'pointer',
                            display: 'flex',
                            alignItems: 'center',
                            gap: '6px',
                            transition: 'all 0.2s'
                        }}
                    >
                        {copied ? <><Icons.Check /> Copied!</> : <><Icons.Copy /> Copy</>}
                    </button>
                </div>
                
                <pre style={{
                    background: '#0a0a0c',
                    borderRadius: '10px',
                    padding: '16px',
                    fontFamily: 'var(--font-mono)',
                    fontSize: '13px',
                    color: 'var(--accent-cyan)',
                    overflowX: 'auto',
                    whiteSpace: 'pre-wrap',
                    wordBreak: 'break-all',
                    lineHeight: '1.6',
                    border: '1px solid var(--border)'
                }}>
                    {command || '# Enter a URL and select a preset to generate a command'}
                </pre>
            </div>
        );

        // Extra Options
        const ExtraOptions = ({ options, setOptions }) => {
            const [expanded, setExpanded] = useState(false);
            
            return (
                <div style={{
                    background: 'var(--bg-surface)',
                    borderRadius: '16px',
                    padding: '20px',
                    marginBottom: '20px',
                    border: '1px solid var(--border)'
                }}>
                    <button
                        onClick={() => setExpanded(!expanded)}
                        style={{
                            width: '100%',
                            display: 'flex',
                            justifyContent: 'space-between',
                            alignItems: 'center',
                            background: 'none',
                            border: 'none',
                            color: 'var(--text-primary)',
                            cursor: 'pointer',
                            padding: 0
                        }}
                    >
                        <div style={{ display: 'flex', alignItems: 'center', gap: '10px' }}>
                            <Icons.Settings />
                            <span style={{ fontSize: '16px', fontWeight: '600' }}>Advanced Options</span>
                        </div>
                        <div style={{
                            transform: expanded ? 'rotate(180deg)' : 'rotate(0)',
                            transition: 'transform 0.2s'
                        }}>
                            <Icons.ChevronDown />
                        </div>
                    </button>
                    
                    {expanded && (
                        <div style={{
                            marginTop: '20px',
                            display: 'grid',
                            gridTemplateColumns: 'repeat(auto-fill, minmax(200px, 1fr))',
                            gap: '16px',
                            animation: 'fadeIn 0.2s ease-out'
                        }}>
                            <label style={{ display: 'flex', alignItems: 'center', gap: '10px', cursor: 'pointer' }}>
                                <input
                                    type="checkbox"
                                    checked={options.downloadSubtitles}
                                    onChange={(e) => setOptions({ ...options, downloadSubtitles: e.target.checked })}
                                    style={{ width: '18px', height: '18px', accentColor: 'var(--accent-blue)' }}
                                />
                                <span style={{ fontSize: '14px', color: 'var(--text-secondary)' }}>Download Subtitles</span>
                            </label>
                            
                            <label style={{ display: 'flex', alignItems: 'center', gap: '10px', cursor: 'pointer' }}>
                                <input
                                    type="checkbox"
                                    checked={options.sponsorBlock}
                                    onChange={(e) => setOptions({ ...options, sponsorBlock: e.target.checked })}
                                    style={{ width: '18px', height: '18px', accentColor: 'var(--accent-blue)' }}
                                />
                                <span style={{ fontSize: '14px', color: 'var(--text-secondary)' }}>Remove Sponsors</span>
                            </label>
                            
                            <label style={{ display: 'flex', alignItems: 'center', gap: '10px', cursor: 'pointer' }}>
                                <input
                                    type="checkbox"
                                    checked={options.noPlaylist}
                                    onChange={(e) => setOptions({ ...options, noPlaylist: e.target.checked })}
                                    style={{ width: '18px', height: '18px', accentColor: 'var(--accent-blue)' }}
                                />
                                <span style={{ fontSize: '14px', color: 'var(--text-secondary)' }}>Single Video Only</span>
                            </label>
                            
                            <div>
                                <label style={{ fontSize: '12px', color: 'var(--text-muted)', marginBottom: '6px', display: 'block' }}>
                                    Output Path
                                </label>
                                <input
                                    type="text"
                                    value={options.outputPath || ''}
                                    onChange={(e) => setOptions({ ...options, outputPath: e.target.value })}
                                    placeholder="~/Downloads"
                                    style={{
                                        width: '100%',
                                        padding: '8px 12px',
                                        background: 'var(--bg-elevated)',
                                        border: '1px solid var(--border)',
                                        borderRadius: '6px',
                                        color: 'var(--text-primary)',
                                        fontSize: '13px',
                                        fontFamily: 'var(--font-mono)'
                                    }}
                                />
                            </div>
                            
                            <div>
                                <label style={{ fontSize: '12px', color: 'var(--text-muted)', marginBottom: '6px', display: 'block' }}>
                                    Rate Limit
                                </label>
                                <input
                                    type="text"
                                    value={options.limitRate || ''}
                                    onChange={(e) => setOptions({ ...options, limitRate: e.target.value })}
                                    placeholder="5M"
                                    style={{
                                        width: '100%',
                                        padding: '8px 12px',
                                        background: 'var(--bg-elevated)',
                                        border: '1px solid var(--border)',
                                        borderRadius: '6px',
                                        color: 'var(--text-primary)',
                                        fontSize: '13px',
                                        fontFamily: 'var(--font-mono)'
                                    }}
                                />
                            </div>
                            
                            <div>
                                <label style={{ fontSize: '12px', color: 'var(--text-muted)', marginBottom: '6px', display: 'block' }}>
                                    Playlist Items
                                </label>
                                <input
                                    type="text"
                                    value={options.playlistItems || ''}
                                    onChange={(e) => setOptions({ ...options, playlistItems: e.target.value })}
                                    placeholder="1-5, 10"
                                    style={{
                                        width: '100%',
                                        padding: '8px 12px',
                                        background: 'var(--bg-elevated)',
                                        border: '1px solid var(--border)',
                                        borderRadius: '6px',
                                        color: 'var(--text-primary)',
                                        fontSize: '13px',
                                        fontFamily: 'var(--font-mono)'
                                    }}
                                />
                            </div>
                        </div>
                    )}
                </div>
            );
        };

        // Timestamp Converter
        const TimestampConverter = () => {
            const [inputFormat, setInputFormat] = useState('timecode');
            const [outputFormat, setOutputFormat] = useState('youtube');
            const [orderFormat, setOrderFormat] = useState('title-first');
            const [input, setInput] = useState('');
            const [output, setOutput] = useState('');
            const [copied, setCopied] = useState(false);

            const parseTimecode = (line, order) => {
                // Parse different formats
                // Title First: "Intro 00:00:00"
                // Timestamp First: "00:00:00 Intro"
                const timeRegex = /(\d{1,2}:)?(\d{1,2}):(\d{2})/;
                const match = line.match(timeRegex);
                if (!match) return null;
                
                const timeStr = match[0];
                const parts = timeStr.split(':').map(Number);
                let seconds = 0;
                if (parts.length === 3) {
                    seconds = parts[0] * 3600 + parts[1] * 60 + parts[2];
                } else {
                    seconds = parts[0] * 60 + parts[1];
                }
                
                let title = line.replace(timeStr, '').trim();
                // Remove common separators
                title = title.replace(/^[-:]\s*/, '').replace(/\s*[-:]$/, '').trim();
                
                return { title, seconds, timeStr };
            };

            const formatTime = (seconds, format) => {
                const h = Math.floor(seconds / 3600);
                const m = Math.floor((seconds % 3600) / 60);
                const s = seconds % 60;
                
                if (format === 'youtube') {
                    if (h > 0) {
                        return `${h}:${m.toString().padStart(2, '0')}:${s.toString().padStart(2, '0')}`;
                    }
                    return `${m}:${s.toString().padStart(2, '0')}`;
                } else if (format === 'timecode') {
                    return `${h.toString().padStart(2, '0')}:${m.toString().padStart(2, '0')}:${s.toString().padStart(2, '0')}:00`;
                } else if (format === 'ffmpeg') {
                    return `${h.toString().padStart(2, '0')}:${m.toString().padStart(2, '0')}:${s.toString().padStart(2, '0')}.000`;
                }
                return '';
            };

            const convert = () => {
                const lines = input.split('\n').filter(l => l.trim());
                const chapters = lines.map(line => parseTimecode(line, orderFormat)).filter(Boolean);
                
                if (outputFormat === 'youtube') {
                    const result = chapters.map(ch => 
                        orderFormat === 'title-first' 
                            ? `${ch.title} ${formatTime(ch.seconds, 'youtube')}`
                            : `${formatTime(ch.seconds, 'youtube')} ${ch.title}`
                    ).join('\n');
                    setOutput(result);
                } else if (outputFormat === 'ffmpeg') {
                    let result = ';FFMETADATA1\n';
                    chapters.forEach((ch, i) => {
                        const nextCh = chapters[i + 1];
                        const endTime = nextCh ? nextCh.seconds * 1000 : (ch.seconds + 60) * 1000;
                        result += `\n[CHAPTER]\nTIMEBASE=1/1000\nSTART=${ch.seconds * 1000}\nEND=${endTime}\ntitle=${ch.title}\n`;
                    });
                    setOutput(result);
                } else if (outputFormat === 'timecode') {
                    const result = chapters.map(ch => 
                        orderFormat === 'title-first'
                            ? `${ch.title} ${formatTime(ch.seconds, 'timecode')}`
                            : `${formatTime(ch.seconds, 'timecode')} ${ch.title}`
                    ).join('\n');
                    setOutput(result);
                }
            };

            const handleCopy = () => {
                navigator.clipboard.writeText(output);
                setCopied(true);
                setTimeout(() => setCopied(false), 2000);
            };

            return (
                <div className="animate-in">
                    <div style={{
                        background: 'var(--bg-surface)',
                        borderRadius: '16px',
                        padding: '24px',
                        border: '1px solid var(--border)',
                        marginBottom: '20px'
                    }}>
                        <div style={{ display: 'flex', alignItems: 'center', gap: '10px', marginBottom: '8px' }}>
                            <Icons.Sparkles />
                            <h2 style={{ fontSize: '20px', fontWeight: '600' }}>Chapter Timestamp Converter</h2>
                        </div>
                        <p style={{ color: 'var(--text-muted)', fontSize: '14px' }}>
                            Convert chapter timestamps between YouTube Chapters, Timecode, and FFMPEG metadata formats.
                        </p>
                    </div>
                    
                    <div style={{
                        display: 'grid',
                        gridTemplateColumns: 'repeat(3, 1fr)',
                        gap: '16px',
                        marginBottom: '20px'
                    }}>
                        <div>
                            <label style={{ fontSize: '13px', color: 'var(--text-muted)', marginBottom: '8px', display: 'block' }}>From</label>
                            <select
                                value={inputFormat}
                                onChange={(e) => setInputFormat(e.target.value)}
                                style={{
                                    width: '100%',
                                    padding: '12px 16px',
                                    background: 'var(--bg-surface)',
                                    border: '1px solid var(--border)',
                                    borderRadius: '10px',
                                    color: 'var(--text-primary)',
                                    fontSize: '14px',
                                    cursor: 'pointer'
                                }}
                            >
                                <option value="timecode">Timecode</option>
                                <option value="youtube">YouTube Chapters</option>
                                <option value="ffmpeg">FFMPEG Metadata</option>
                            </select>
                        </div>
                        
                        <div>
                            <label style={{ fontSize: '13px', color: 'var(--text-muted)', marginBottom: '8px', display: 'block' }}>To</label>
                            <select
                                value={outputFormat}
                                onChange={(e) => setOutputFormat(e.target.value)}
                                style={{
                                    width: '100%',
                                    padding: '12px 16px',
                                    background: 'var(--bg-surface)',
                                    border: '1px solid var(--border)',
                                    borderRadius: '10px',
                                    color: 'var(--text-primary)',
                                    fontSize: '14px',
                                    cursor: 'pointer'
                                }}
                            >
                                <option value="youtube">YouTube Chapters</option>
                                <option value="timecode">Timecode</option>
                                <option value="ffmpeg">FFMPEG Metadata</option>
                            </select>
                        </div>
                        
                        <div>
                            <label style={{ fontSize: '13px', color: 'var(--text-muted)', marginBottom: '8px', display: 'block' }}>Order</label>
                            <select
                                value={orderFormat}
                                onChange={(e) => setOrderFormat(e.target.value)}
                                style={{
                                    width: '100%',
                                    padding: '12px 16px',
                                    background: 'var(--bg-surface)',
                                    border: '1px solid var(--border)',
                                    borderRadius: '10px',
                                    color: 'var(--text-primary)',
                                    fontSize: '14px',
                                    cursor: 'pointer'
                                }}
                            >
                                <option value="title-first">Title First</option>
                                <option value="timestamp-first">Timestamp First</option>
                            </select>
                        </div>
                    </div>
                    
                    <div style={{
                        display: 'grid',
                        gridTemplateColumns: '1fr 1fr',
                        gap: '20px'
                    }}>
                        <div>
                            <div style={{
                                display: 'flex',
                                alignItems: 'center',
                                gap: '8px',
                                marginBottom: '12px'
                            }}>
                                <Icons.Clock />
                                <label style={{ fontSize: '14px', fontWeight: '500' }}>Input</label>
                            </div>
                            <textarea
                                value={input}
                                onChange={(e) => setInput(e.target.value)}
                                placeholder={`Paste your timecode list here.\nSupports:\nTitle First: Intro 00:00:00:00\nTimestamp First: 00:00:00:00 Intro`}
                                style={{
                                    width: '100%',
                                    height: '300px',
                                    padding: '16px',
                                    background: 'var(--bg-surface)',
                                    border: '1px solid var(--border)',
                                    borderRadius: '12px',
                                    color: 'var(--text-primary)',
                                    fontSize: '14px',
                                    fontFamily: 'var(--font-mono)',
                                    resize: 'vertical',
                                    outline: 'none'
                                }}
                            />
                            <button
                                onClick={convert}
                                style={{
                                    width: '100%',
                                    marginTop: '12px',
                                    padding: '14px',
                                    background: 'linear-gradient(135deg, var(--accent-blue) 0%, var(--accent-purple) 100%)',
                                    border: 'none',
                                    borderRadius: '10px',
                                    color: 'white',
                                    fontSize: '15px',
                                    fontWeight: '600',
                                    cursor: 'pointer',
                                    display: 'flex',
                                    alignItems: 'center',
                                    justifyContent: 'center',
                                    gap: '8px'
                                }}
                            >
                                <Icons.ArrowRight /> Convert
                            </button>
                        </div>
                        
                        <div>
                            <div style={{
                                display: 'flex',
                                alignItems: 'center',
                                justifyContent: 'space-between',
                                marginBottom: '12px'
                            }}>
                                <div style={{ display: 'flex', alignItems: 'center', gap: '8px' }}>
                                    <Icons.Terminal />
                                    <label style={{ fontSize: '14px', fontWeight: '500' }}>Output</label>
                                </div>
                                {output && (
                                    <button
                                        onClick={handleCopy}
                                        style={{
                                            padding: '6px 12px',
                                            background: copied ? 'var(--accent-green)' : 'var(--bg-elevated)',
                                            border: '1px solid var(--border)',
                                            borderRadius: '6px',
                                            color: copied ? 'white' : 'var(--text-secondary)',
                                            fontSize: '12px',
                                            cursor: 'pointer',
                                            display: 'flex',
                                            alignItems: 'center',
                                            gap: '4px'
                                        }}
                                    >
                                        {copied ? <><Icons.Check /> Copied</> : <><Icons.Copy /> Copy</>}
                                    </button>
                                )}
                            </div>
                            <textarea
                                value={output}
                                readOnly
                                placeholder="Converted output will appear here..."
                                style={{
                                    width: '100%',
                                    height: '300px',
                                    padding: '16px',
                                    background: '#0a0a0c',
                                    border: '1px solid var(--border)',
                                    borderRadius: '12px',
                                    color: 'var(--accent-cyan)',
                                    fontSize: '14px',
                                    fontFamily: 'var(--font-mono)',
                                    resize: 'vertical',
                                    outline: 'none'
                                }}
                            />
                        </div>
                    </div>
                </div>
            );
        };

        // Presets Page
        const PresetsPage = ({ presets, setPresets, onEditPreset }) => {
            const handleToggleDefault = (id) => {
                setPresets(presets.map(p => ({
                    ...p,
                    isDefault: p.id === id
                })));
            };

            const handleDelete = (id) => {
                if (presets.length <= 1) return;
                setPresets(presets.filter(p => p.id !== id));
            };

            const handleNewPreset = () => {
                const newPreset = {
                    id: `preset-${Date.now()}`,
                    name: 'New Preset',
                    isDefault: false,
                    quality: '1080',
                    format: 'bestvideo[height<=1080]+bestaudio/best',
                    outputTemplate: '%(title)s.%(ext)s',
                    embedChapters: true,
                    embedMetadata: true,
                    embedThumbnail: false,
                    extractAudio: false,
                    audioFormat: 'mp3',
                    audioQuality: '0',
                };
                setPresets([...presets, newPreset]);
                onEditPreset(newPreset);
            };

            return (
                <div className="animate-in">
                    <div style={{
                        background: 'var(--bg-surface)',
                        borderRadius: '16px',
                        padding: '24px',
                        border: '1px solid var(--border)',
                        marginBottom: '20px'
                    }}>
                        <div style={{ display: 'flex', alignItems: 'center', gap: '10px', marginBottom: '8px' }}>
                            <Icons.Settings />
                            <h2 style={{ fontSize: '20px', fontWeight: '600' }}>Configurations</h2>
                        </div>
                        <p style={{ color: 'var(--text-muted)', fontSize: '14px' }}>
                            Save and manage your download presets for quick access.
                        </p>
                    </div>
                    
                    <button
                        onClick={handleNewPreset}
                        style={{
                            width: '100%',
                            padding: '16px',
                            background: 'linear-gradient(135deg, var(--accent-blue) 0%, var(--accent-purple) 100%)',
                            border: 'none',
                            borderRadius: '12px',
                            color: 'white',
                            fontSize: '15px',
                            fontWeight: '600',
                            cursor: 'pointer',
                            display: 'flex',
                            alignItems: 'center',
                            justifyContent: 'center',
                            gap: '8px',
                            marginBottom: '20px'
                        }}
                    >
                        <Icons.Plus /> New Preset
                    </button>
                    
                    <div style={{
                        display: 'grid',
                        gridTemplateColumns: 'repeat(auto-fill, minmax(320px, 1fr))',
                        gap: '16px'
                    }}>
                        {presets.map(preset => (
                            <PresetCard
                                key={preset.id}
                                preset={preset}
                                isSelected={false}
                                onSelect={() => {}}
                                onEdit={onEditPreset}
                                onDelete={handleDelete}
                                onToggleDefault={handleToggleDefault}
                            />
                        ))}
                    </div>
                </div>
            );
        };

        // History Page
        const HistoryPage = ({ history, onUseCommand, onClearHistory }) => (
            <div className="animate-in">
                <div style={{
                    background: 'var(--bg-surface)',
                    borderRadius: '16px',
                    padding: '24px',
                    border: '1px solid var(--border)',
                    marginBottom: '20px'
                }}>
                    <div style={{
                        display: 'flex',
                        justifyContent: 'space-between',
                        alignItems: 'start'
                    }}>
                        <div>
                            <div style={{ display: 'flex', alignItems: 'center', gap: '10px', marginBottom: '8px' }}>
                                <Icons.History />
                                <h2 style={{ fontSize: '20px', fontWeight: '600' }}>Command History</h2>
                            </div>
                            <p style={{ color: 'var(--text-muted)', fontSize: '14px' }}>
                                Recently generated commands for quick access.
                            </p>
                        </div>
                        {history.length > 0 && (
                            <button
                                onClick={onClearHistory}
                                style={{
                                    padding: '8px 16px',
                                    background: 'rgba(239,68,68,0.1)',
                                    border: '1px solid rgba(239,68,68,0.2)',
                                    borderRadius: '8px',
                                    color: 'var(--accent-red)',
                                    fontSize: '13px',
                                    cursor: 'pointer',
                                    display: 'flex',
                                    alignItems: 'center',
                                    gap: '6px'
                                }}
                            >
                                <Icons.Trash /> Clear All
                            </button>
                        )}
                    </div>
                </div>
                
                {history.length === 0 ? (
                    <div style={{
                        textAlign: 'center',
                        padding: '60px 20px',
                        color: 'var(--text-muted)'
                    }}>
                        <Icons.History />
                        <p style={{ marginTop: '12px' }}>No commands in history yet</p>
                    </div>
                ) : (
                    <div style={{ display: 'flex', flexDirection: 'column', gap: '12px' }}>
                        {history.map((item, index) => (
                            <div
                                key={index}
                                style={{
                                    background: 'var(--bg-surface)',
                                    borderRadius: '12px',
                                    padding: '16px',
                                    border: '1px solid var(--border)'
                                }}
                            >
                                <div style={{
                                    display: 'flex',
                                    justifyContent: 'space-between',
                                    alignItems: 'start',
                                    marginBottom: '12px'
                                }}>
                                    <div>
                                        <div style={{ fontSize: '13px', color: 'var(--text-muted)', marginBottom: '4px' }}>
                                            {new Date(item.timestamp).toLocaleString()}
                                        </div>
                                        <div style={{ fontSize: '14px', color: 'var(--text-secondary)' }}>
                                            {item.preset}
                                        </div>
                                    </div>
                                    <button
                                        onClick={() => onUseCommand(item)}
                                        style={{
                                            padding: '6px 12px',
                                            background: 'var(--accent-blue)',
                                            border: 'none',
                                            borderRadius: '6px',
                                            color: 'white',
                                            fontSize: '12px',
                                            cursor: 'pointer'
                                        }}
                                    >
                                        Use
                                    </button>
                                </div>
                                <pre style={{
                                    background: '#0a0a0c',
                                    borderRadius: '8px',
                                    padding: '12px',
                                    fontFamily: 'var(--font-mono)',
                                    fontSize: '12px',
                                    color: 'var(--accent-cyan)',
                                    overflow: 'auto',
                                    whiteSpace: 'pre-wrap',
                                    wordBreak: 'break-all'
                                }}>
                                    {item.command}
                                </pre>
                            </div>
                        ))}
                    </div>
                )}
            </div>
        );

        // Preset Editor Modal
        const PresetEditor = ({ preset, onSave, onClose }) => {
            const [editedPreset, setEditedPreset] = useState({ ...preset });
            
            const handleSave = () => {
                onSave(editedPreset);
                onClose();
            };

            return (
                <div style={{
                    position: 'fixed',
                    top: 0,
                    left: 0,
                    right: 0,
                    bottom: 0,
                    background: 'rgba(0,0,0,0.8)',
                    display: 'flex',
                    alignItems: 'center',
                    justifyContent: 'center',
                    zIndex: 100,
                    padding: '20px'
                }}>
                    <div style={{
                        background: 'var(--bg-surface)',
                        borderRadius: '20px',
                        padding: '28px',
                        maxWidth: '500px',
                        width: '100%',
                        maxHeight: '90vh',
                        overflow: 'auto',
                        border: '1px solid var(--border)',
                        animation: 'fadeIn 0.2s ease-out'
                    }}>
                        <div style={{
                            display: 'flex',
                            justifyContent: 'space-between',
                            alignItems: 'center',
                            marginBottom: '24px'
                        }}>
                            <h2 style={{ fontSize: '20px', fontWeight: '600' }}>Edit Preset</h2>
                            <button
                                onClick={onClose}
                                style={{
                                    background: 'none',
                                    border: 'none',
                                    color: 'var(--text-muted)',
                                    cursor: 'pointer',
                                    padding: '4px'
                                }}
                            >
                                <Icons.X />
                            </button>
                        </div>
                        
                        <div style={{ display: 'flex', flexDirection: 'column', gap: '16px' }}>
                            <div>
                                <label style={{ fontSize: '13px', color: 'var(--text-muted)', marginBottom: '6px', display: 'block' }}>
                                    Preset Name
                                </label>
                                <input
                                    type="text"
                                    value={editedPreset.name}
                                    onChange={(e) => setEditedPreset({ ...editedPreset, name: e.target.value })}
                                    style={{
                                        width: '100%',
                                        padding: '12px 16px',
                                        background: 'var(--bg-elevated)',
                                        border: '1px solid var(--border)',
                                        borderRadius: '10px',
                                        color: 'var(--text-primary)',
                                        fontSize: '14px'
                                    }}
                                />
                            </div>
                            
                            <div>
                                <label style={{ fontSize: '13px', color: 'var(--text-muted)', marginBottom: '6px', display: 'block' }}>
                                    Quality
                                </label>
                                <select
                                    value={editedPreset.quality}
                                    onChange={(e) => {
                                        const q = e.target.value;
                                        setEditedPreset({
                                            ...editedPreset,
                                            quality: q,
                                            format: q === 'best' ? 'bestaudio' : `bestvideo[height<=${q}]+bestaudio/best`
                                        });
                                    }}
                                    style={{
                                        width: '100%',
                                        padding: '12px 16px',
                                        background: 'var(--bg-elevated)',
                                        border: '1px solid var(--border)',
                                        borderRadius: '10px',
                                        color: 'var(--text-primary)',
                                        fontSize: '14px'
                                    }}
                                >
                                    <option value="2160">4K (2160p)</option>
                                    <option value="1440">1440p</option>
                                    <option value="1080">1080p</option>
                                    <option value="720">720p</option>
                                    <option value="480">480p</option>
                                    <option value="best">Best Audio Only</option>
                                </select>
                            </div>
                            
                            <div>
                                <label style={{ fontSize: '13px', color: 'var(--text-muted)', marginBottom: '6px', display: 'block' }}>
                                    Output Template
                                </label>
                                <input
                                    type="text"
                                    value={editedPreset.outputTemplate}
                                    onChange={(e) => setEditedPreset({ ...editedPreset, outputTemplate: e.target.value })}
                                    style={{
                                        width: '100%',
                                        padding: '12px 16px',
                                        background: 'var(--bg-elevated)',
                                        border: '1px solid var(--border)',
                                        borderRadius: '10px',
                                        color: 'var(--text-primary)',
                                        fontSize: '14px',
                                        fontFamily: 'var(--font-mono)'
                                    }}
                                />
                                <p style={{ fontSize: '11px', color: 'var(--text-muted)', marginTop: '6px' }}>
                                    Variables: %(title)s, %(ext)s, %(playlist_index)s, %(uploader)s
                                </p>
                            </div>
                            
                            <div>
                                <label style={{ fontSize: '13px', color: 'var(--text-muted)', marginBottom: '12px', display: 'block' }}>
                                    Embed Options
                                </label>
                                <div style={{ display: 'flex', flexDirection: 'column', gap: '10px' }}>
                                    {[
                                        { key: 'embedChapters', label: 'Embed Chapters' },
                                        { key: 'embedMetadata', label: 'Embed Metadata' },
                                        { key: 'embedThumbnail', label: 'Embed Thumbnail' },
                                        { key: 'extractAudio', label: 'Extract Audio Only' },
                                    ].map(opt => (
                                        <label key={opt.key} style={{ display: 'flex', alignItems: 'center', gap: '10px', cursor: 'pointer' }}>
                                            <input
                                                type="checkbox"
                                                checked={editedPreset[opt.key]}
                                                onChange={(e) => setEditedPreset({ ...editedPreset, [opt.key]: e.target.checked })}
                                                style={{ width: '18px', height: '18px', accentColor: 'var(--accent-blue)' }}
                                            />
                                            <span style={{ fontSize: '14px', color: 'var(--text-secondary)' }}>{opt.label}</span>
                                        </label>
                                    ))}
                                </div>
                            </div>
                            
                            {editedPreset.extractAudio && (
                                <div>
                                    <label style={{ fontSize: '13px', color: 'var(--text-muted)', marginBottom: '6px', display: 'block' }}>
                                        Audio Format
                                    </label>
                                    <select
                                        value={editedPreset.audioFormat}
                                        onChange={(e) => setEditedPreset({ ...editedPreset, audioFormat: e.target.value })}
                                        style={{
                                            width: '100%',
                                            padding: '12px 16px',
                                            background: 'var(--bg-elevated)',
                                            border: '1px solid var(--border)',
                                            borderRadius: '10px',
                                            color: 'var(--text-primary)',
                                            fontSize: '14px'
                                        }}
                                    >
                                        <option value="mp3">MP3</option>
                                        <option value="m4a">M4A</option>
                                        <option value="flac">FLAC</option>
                                        <option value="wav">WAV</option>
                                        <option value="opus">Opus</option>
                                    </select>
                                </div>
                            )}
                        </div>
                        
                        <div style={{
                            display: 'flex',
                            gap: '12px',
                            marginTop: '24px'
                        }}>
                            <button
                                onClick={onClose}
                                style={{
                                    flex: 1,
                                    padding: '14px',
                                    background: 'var(--bg-elevated)',
                                    border: '1px solid var(--border)',
                                    borderRadius: '10px',
                                    color: 'var(--text-secondary)',
                                    fontSize: '14px',
                                    fontWeight: '500',
                                    cursor: 'pointer'
                                }}
                            >
                                Cancel
                            </button>
                            <button
                                onClick={handleSave}
                                style={{
                                    flex: 1,
                                    padding: '14px',
                                    background: 'var(--accent-blue)',
                                    border: 'none',
                                    borderRadius: '10px',
                                    color: 'white',
                                    fontSize: '14px',
                                    fontWeight: '500',
                                    cursor: 'pointer'
                                }}
                            >
                                Save Changes
                            </button>
                        </div>
                    </div>
                </div>
            );
        };

        // ============== PRO FEATURES COMPONENTS ==============

        // Caption Style Editor Component
        const CaptionStyleEditor = ({ style, onSave, onClose }) => {
            const [formData, setFormData] = useState(style || {
                name: '',
                style_type: 'karaoke',
                font_family: 'Arial',
                font_size: 48,
                font_weight: 'bold',
                text_color: '#FFFFFF',
                highlight_color: '#FFFF00',
                background_color: 'rgba(0,0,0,0.5)',
                stroke_color: '#000000',
                stroke_width: 2,
                position: 'bottom',
                margin_bottom: 50,
                animation_duration: 0.3,
                words_per_line: 5,
            });
            const [saving, setSaving] = useState(false);
            const [error, setError] = useState(null);

            const handleSubmit = async () => {
                if (!formData.name.trim()) {
                    setError('Please enter a style name');
                    return;
                }
                setSaving(true);
                setError(null);
                try {
                    const endpoint = style?.id ? `/captions/styles/${style.id}` : '/captions/styles';
                    const method = style?.id ? 'PUT' : 'POST';
                    const result = await apiFetch(endpoint, { method, body: JSON.stringify(formData) });
                    onSave(result);
                } catch (err) {
                    setError(err.message);
                } finally {
                    setSaving(false);
                }
            };

            const inputStyle = {
                width: '100%',
                padding: '10px 12px',
                background: 'var(--bg-elevated)',
                border: '1px solid var(--border)',
                borderRadius: '8px',
                color: 'var(--text-primary)',
                fontSize: '14px',
            };

            const labelStyle = {
                display: 'block',
                fontSize: '12px',
                color: 'var(--text-muted)',
                marginBottom: '6px',
            };

            return (
                <div style={{
                    position: 'fixed',
                    top: 0, left: 0, right: 0, bottom: 0,
                    background: 'rgba(0,0,0,0.7)',
                    display: 'flex',
                    alignItems: 'center',
                    justifyContent: 'center',
                    zIndex: 1000,
                }} onClick={onClose}>
                    <div style={{
                        background: 'var(--bg-surface)',
                        borderRadius: '16px',
                        padding: '24px',
                        width: '90%',
                        maxWidth: '600px',
                        maxHeight: '85vh',
                        overflow: 'auto',
                        border: '1px solid var(--border)',
                    }} onClick={e => e.stopPropagation()}>
                        <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center', marginBottom: '20px' }}>
                            <h3 style={{ fontSize: '18px', fontWeight: '600', display: 'flex', alignItems: 'center', gap: '8px' }}>
                                <Icons.Type />
                                {style?.id ? 'Edit Caption Style' : 'Create Caption Style'}
                            </h3>
                            <button onClick={onClose} style={{ background: 'none', border: 'none', color: 'var(--text-muted)', cursor: 'pointer' }}>
                                <Icons.X />
                            </button>
                        </div>

                        {error && (
                            <div style={{ padding: '12px', background: 'rgba(239,68,68,0.1)', border: '1px solid var(--accent-red)', borderRadius: '8px', marginBottom: '16px', fontSize: '13px', color: 'var(--accent-red)' }}>
                                {error}
                            </div>
                        )}

                        <div style={{ display: 'grid', gridTemplateColumns: '1fr 1fr', gap: '16px' }}>
                            {/* Name */}
                            <div style={{ gridColumn: 'span 2' }}>
                                <label style={labelStyle}>Style Name *</label>
                                <input
                                    type="text"
                                    value={formData.name}
                                    onChange={e => setFormData({ ...formData, name: e.target.value })}
                                    placeholder="e.g., Bold Karaoke"
                                    style={inputStyle}
                                />
                            </div>

                            {/* Style Type */}
                            <div>
                                <label style={labelStyle}>Animation Style</label>
                                <select
                                    value={formData.style_type}
                                    onChange={e => setFormData({ ...formData, style_type: e.target.value })}
                                    style={inputStyle}
                                >
                                    {CAPTION_STYLE_TYPES.map(t => (
                                        <option key={t.value} value={t.value}>{t.label}</option>
                                    ))}
                                </select>
                            </div>

                            {/* Position */}
                            <div>
                                <label style={labelStyle}>Position</label>
                                <select
                                    value={formData.position}
                                    onChange={e => setFormData({ ...formData, position: e.target.value })}
                                    style={inputStyle}
                                >
                                    {CAPTION_POSITIONS.map(p => (
                                        <option key={p.value} value={p.value}>{p.label}</option>
                                    ))}
                                </select>
                            </div>

                            {/* Font Family */}
                            <div>
                                <label style={labelStyle}>Font Family</label>
                                <select
                                    value={formData.font_family}
                                    onChange={e => setFormData({ ...formData, font_family: e.target.value })}
                                    style={inputStyle}
                                >
                                    {['Arial', 'Helvetica', 'Impact', 'Comic Sans MS', 'Verdana', 'Georgia', 'Times New Roman', 'Courier New'].map(f => (
                                        <option key={f} value={f}>{f}</option>
                                    ))}
                                </select>
                            </div>

                            {/* Font Size */}
                            <div>
                                <label style={labelStyle}>Font Size</label>
                                <input
                                    type="number"
                                    value={formData.font_size}
                                    onChange={e => setFormData({ ...formData, font_size: parseInt(e.target.value) || 48 })}
                                    min="12"
                                    max="120"
                                    style={inputStyle}
                                />
                            </div>

                            {/* Colors */}
                            <div>
                                <label style={labelStyle}>Text Color</label>
                                <div style={{ display: 'flex', gap: '8px' }}>
                                    <input
                                        type="color"
                                        value={formData.text_color}
                                        onChange={e => setFormData({ ...formData, text_color: e.target.value })}
                                        style={{ width: '40px', height: '38px', border: 'none', borderRadius: '6px', cursor: 'pointer' }}
                                    />
                                    <input type="text" value={formData.text_color} onChange={e => setFormData({ ...formData, text_color: e.target.value })} style={{ ...inputStyle, flex: 1 }} />
                                </div>
                            </div>

                            <div>
                                <label style={labelStyle}>Highlight Color</label>
                                <div style={{ display: 'flex', gap: '8px' }}>
                                    <input
                                        type="color"
                                        value={formData.highlight_color}
                                        onChange={e => setFormData({ ...formData, highlight_color: e.target.value })}
                                        style={{ width: '40px', height: '38px', border: 'none', borderRadius: '6px', cursor: 'pointer' }}
                                    />
                                    <input type="text" value={formData.highlight_color} onChange={e => setFormData({ ...formData, highlight_color: e.target.value })} style={{ ...inputStyle, flex: 1 }} />
                                </div>
                            </div>

                            <div>
                                <label style={labelStyle}>Stroke Color</label>
                                <div style={{ display: 'flex', gap: '8px' }}>
                                    <input
                                        type="color"
                                        value={formData.stroke_color}
                                        onChange={e => setFormData({ ...formData, stroke_color: e.target.value })}
                                        style={{ width: '40px', height: '38px', border: 'none', borderRadius: '6px', cursor: 'pointer' }}
                                    />
                                    <input type="text" value={formData.stroke_color} onChange={e => setFormData({ ...formData, stroke_color: e.target.value })} style={{ ...inputStyle, flex: 1 }} />
                                </div>
                            </div>

                            <div>
                                <label style={labelStyle}>Stroke Width</label>
                                <input
                                    type="number"
                                    value={formData.stroke_width}
                                    onChange={e => setFormData({ ...formData, stroke_width: parseInt(e.target.value) || 0 })}
                                    min="0"
                                    max="10"
                                    style={inputStyle}
                                />
                            </div>

                            {/* Words per line */}
                            <div>
                                <label style={labelStyle}>Words Per Line</label>
                                <input
                                    type="number"
                                    value={formData.words_per_line}
                                    onChange={e => setFormData({ ...formData, words_per_line: parseInt(e.target.value) || 5 })}
                                    min="1"
                                    max="15"
                                    style={inputStyle}
                                />
                            </div>

                            {/* Animation Duration */}
                            <div>
                                <label style={labelStyle}>Animation Duration (s)</label>
                                <input
                                    type="number"
                                    value={formData.animation_duration}
                                    onChange={e => setFormData({ ...formData, animation_duration: parseFloat(e.target.value) || 0.3 })}
                                    min="0.1"
                                    max="2"
                                    step="0.1"
                                    style={inputStyle}
                                />
                            </div>
                        </div>

                        {/* Preview */}
                        <div style={{ marginTop: '20px', padding: '24px', background: 'var(--bg-base)', borderRadius: '12px', textAlign: 'center' }}>
                            <label style={{ ...labelStyle, marginBottom: '12px' }}>Preview</label>
                            <div style={{
                                fontFamily: formData.font_family,
                                fontSize: `${Math.min(formData.font_size, 36)}px`,
                                fontWeight: formData.font_weight,
                                color: formData.text_color,
                                textShadow: `${formData.stroke_width}px ${formData.stroke_width}px 0 ${formData.stroke_color}`,
                                padding: '12px 20px',
                                background: formData.background_color,
                                borderRadius: '8px',
                                display: 'inline-block',
                            }}>
                                <span style={{ color: formData.highlight_color }}>Hello</span> world caption
                            </div>
                        </div>

                        {/* Actions */}
                        <div style={{ display: 'flex', gap: '12px', justifyContent: 'flex-end', marginTop: '20px' }}>
                            <button onClick={onClose} style={{ padding: '10px 20px', background: 'var(--bg-elevated)', border: '1px solid var(--border)', borderRadius: '8px', color: 'var(--text-secondary)', cursor: 'pointer' }}>
                                Cancel
                            </button>
                            <button
                                onClick={handleSubmit}
                                disabled={saving}
                                style={{
                                    padding: '10px 20px',
                                    background: 'linear-gradient(135deg, var(--accent-purple) 0%, var(--accent-blue) 100%)',
                                    border: 'none',
                                    borderRadius: '8px',
                                    color: 'white',
                                    cursor: saving ? 'not-allowed' : 'pointer',
                                    fontWeight: '500',
                                    display: 'flex',
                                    alignItems: 'center',
                                    gap: '6px',
                                }}
                            >
                                {saving ? <Icons.Loader /> : <Icons.Check />}
                                {style?.id ? 'Update Style' : 'Create Style'}
                            </button>
                        </div>
                    </div>
                </div>
            );
        };

        // Brand Template Editor Component
        const BrandTemplateEditor = ({ template, onSave, onClose }) => {
            const [formData, setFormData] = useState(template || {
                name: '',
                logo_position: 'top_right',
                logo_size: 100,
                logo_opacity: 1.0,
                logo_margin: 20,
                primary_color: '#3B82F6',
                secondary_color: '#1E40AF',
                accent_color: '#F97316',
                outro_enabled: false,
                outro_duration: 3.0,
                outro_text: 'Thanks for watching!',
                outro_cta_text: 'Subscribe for more',
            });
            const [saving, setSaving] = useState(false);
            const [error, setError] = useState(null);

            const handleSubmit = async () => {
                if (!formData.name.trim()) {
                    setError('Please enter a template name');
                    return;
                }
                setSaving(true);
                setError(null);
                try {
                    const endpoint = template?.id ? `/brands/${template.id}` : '/brands';
                    const method = template?.id ? 'PUT' : 'POST';
                    const result = await apiFetch(endpoint, { method, body: JSON.stringify(formData) });
                    onSave(result);
                } catch (err) {
                    setError(err.message);
                } finally {
                    setSaving(false);
                }
            };

            const inputStyle = {
                width: '100%',
                padding: '10px 12px',
                background: 'var(--bg-elevated)',
                border: '1px solid var(--border)',
                borderRadius: '8px',
                color: 'var(--text-primary)',
                fontSize: '14px',
            };

            const labelStyle = {
                display: 'block',
                fontSize: '12px',
                color: 'var(--text-muted)',
                marginBottom: '6px',
            };

            return (
                <div style={{
                    position: 'fixed',
                    top: 0, left: 0, right: 0, bottom: 0,
                    background: 'rgba(0,0,0,0.7)',
                    display: 'flex',
                    alignItems: 'center',
                    justifyContent: 'center',
                    zIndex: 1000,
                }} onClick={onClose}>
                    <div style={{
                        background: 'var(--bg-surface)',
                        borderRadius: '16px',
                        padding: '24px',
                        width: '90%',
                        maxWidth: '550px',
                        maxHeight: '85vh',
                        overflow: 'auto',
                        border: '1px solid var(--border)',
                    }} onClick={e => e.stopPropagation()}>
                        <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center', marginBottom: '20px' }}>
                            <h3 style={{ fontSize: '18px', fontWeight: '600', display: 'flex', alignItems: 'center', gap: '8px' }}>
                                <Icons.Award />
                                {template?.id ? 'Edit Brand Template' : 'Create Brand Template'}
                            </h3>
                            <button onClick={onClose} style={{ background: 'none', border: 'none', color: 'var(--text-muted)', cursor: 'pointer' }}>
                                <Icons.X />
                            </button>
                        </div>

                        {error && (
                            <div style={{ padding: '12px', background: 'rgba(239,68,68,0.1)', border: '1px solid var(--accent-red)', borderRadius: '8px', marginBottom: '16px', fontSize: '13px', color: 'var(--accent-red)' }}>
                                {error}
                            </div>
                        )}

                        <div style={{ display: 'grid', gridTemplateColumns: '1fr 1fr', gap: '16px' }}>
                            {/* Name */}
                            <div style={{ gridColumn: 'span 2' }}>
                                <label style={labelStyle}>Template Name *</label>
                                <input
                                    type="text"
                                    value={formData.name}
                                    onChange={e => setFormData({ ...formData, name: e.target.value })}
                                    placeholder="e.g., My Brand"
                                    style={inputStyle}
                                />
                            </div>

                            {/* Logo Settings */}
                            <div>
                                <label style={labelStyle}>Logo Position</label>
                                <select
                                    value={formData.logo_position}
                                    onChange={e => setFormData({ ...formData, logo_position: e.target.value })}
                                    style={inputStyle}
                                >
                                    {LOGO_POSITIONS.map(p => (
                                        <option key={p.value} value={p.value}>{p.label}</option>
                                    ))}
                                </select>
                            </div>

                            <div>
                                <label style={labelStyle}>Logo Size (px)</label>
                                <input
                                    type="number"
                                    value={formData.logo_size}
                                    onChange={e => setFormData({ ...formData, logo_size: parseInt(e.target.value) || 100 })}
                                    min="20"
                                    max="500"
                                    style={inputStyle}
                                />
                            </div>

                            <div>
                                <label style={labelStyle}>Logo Opacity</label>
                                <input
                                    type="range"
                                    value={formData.logo_opacity}
                                    onChange={e => setFormData({ ...formData, logo_opacity: parseFloat(e.target.value) })}
                                    min="0"
                                    max="1"
                                    step="0.1"
                                    style={{ width: '100%' }}
                                />
                                <span style={{ fontSize: '12px', color: 'var(--text-muted)' }}>{Math.round(formData.logo_opacity * 100)}%</span>
                            </div>

                            <div>
                                <label style={labelStyle}>Logo Margin (px)</label>
                                <input
                                    type="number"
                                    value={formData.logo_margin}
                                    onChange={e => setFormData({ ...formData, logo_margin: parseInt(e.target.value) || 20 })}
                                    min="0"
                                    max="100"
                                    style={inputStyle}
                                />
                            </div>

                            {/* Colors */}
                            <div>
                                <label style={labelStyle}>Primary Color</label>
                                <div style={{ display: 'flex', gap: '8px' }}>
                                    <input
                                        type="color"
                                        value={formData.primary_color}
                                        onChange={e => setFormData({ ...formData, primary_color: e.target.value })}
                                        style={{ width: '40px', height: '38px', border: 'none', borderRadius: '6px', cursor: 'pointer' }}
                                    />
                                    <input type="text" value={formData.primary_color} readOnly style={{ ...inputStyle, flex: 1 }} />
                                </div>
                            </div>

                            <div>
                                <label style={labelStyle}>Secondary Color</label>
                                <div style={{ display: 'flex', gap: '8px' }}>
                                    <input
                                        type="color"
                                        value={formData.secondary_color}
                                        onChange={e => setFormData({ ...formData, secondary_color: e.target.value })}
                                        style={{ width: '40px', height: '38px', border: 'none', borderRadius: '6px', cursor: 'pointer' }}
                                    />
                                    <input type="text" value={formData.secondary_color} readOnly style={{ ...inputStyle, flex: 1 }} />
                                </div>
                            </div>

                            <div style={{ gridColumn: 'span 2' }}>
                                <label style={labelStyle}>Accent Color</label>
                                <div style={{ display: 'flex', gap: '8px' }}>
                                    <input
                                        type="color"
                                        value={formData.accent_color}
                                        onChange={e => setFormData({ ...formData, accent_color: e.target.value })}
                                        style={{ width: '40px', height: '38px', border: 'none', borderRadius: '6px', cursor: 'pointer' }}
                                    />
                                    <input type="text" value={formData.accent_color} readOnly style={{ ...inputStyle, flex: 1 }} />
                                </div>
                            </div>
                        </div>

                        {/* Outro Settings */}
                        <div style={{ marginTop: '20px', padding: '16px', background: 'var(--bg-elevated)', borderRadius: '12px' }}>
                            <label style={{ display: 'flex', alignItems: 'center', gap: '8px', cursor: 'pointer', marginBottom: '12px' }}>
                                <input
                                    type="checkbox"
                                    checked={formData.outro_enabled}
                                    onChange={e => setFormData({ ...formData, outro_enabled: e.target.checked })}
                                />
                                <span style={{ fontWeight: '500' }}>Enable Outro Screen</span>
                            </label>

                            {formData.outro_enabled && (
                                <div style={{ display: 'grid', gridTemplateColumns: '1fr 1fr', gap: '12px' }}>
                                    <div>
                                        <label style={labelStyle}>Duration (seconds)</label>
                                        <input
                                            type="number"
                                            value={formData.outro_duration}
                                            onChange={e => setFormData({ ...formData, outro_duration: parseFloat(e.target.value) || 3 })}
                                            min="1"
                                            max="10"
                                            step="0.5"
                                            style={inputStyle}
                                        />
                                    </div>
                                    <div style={{ gridColumn: 'span 2' }}>
                                        <label style={labelStyle}>Outro Text</label>
                                        <input
                                            type="text"
                                            value={formData.outro_text}
                                            onChange={e => setFormData({ ...formData, outro_text: e.target.value })}
                                            placeholder="Thanks for watching!"
                                            style={inputStyle}
                                        />
                                    </div>
                                    <div style={{ gridColumn: 'span 2' }}>
                                        <label style={labelStyle}>Call to Action</label>
                                        <input
                                            type="text"
                                            value={formData.outro_cta_text}
                                            onChange={e => setFormData({ ...formData, outro_cta_text: e.target.value })}
                                            placeholder="Subscribe for more"
                                            style={inputStyle}
                                        />
                                    </div>
                                </div>
                            )}
                        </div>

                        {/* Actions */}
                        <div style={{ display: 'flex', gap: '12px', justifyContent: 'flex-end', marginTop: '20px' }}>
                            <button onClick={onClose} style={{ padding: '10px 20px', background: 'var(--bg-elevated)', border: '1px solid var(--border)', borderRadius: '8px', color: 'var(--text-secondary)', cursor: 'pointer' }}>
                                Cancel
                            </button>
                            <button
                                onClick={handleSubmit}
                                disabled={saving}
                                style={{
                                    padding: '10px 20px',
                                    background: 'linear-gradient(135deg, var(--accent-purple) 0%, var(--accent-blue) 100%)',
                                    border: 'none',
                                    borderRadius: '8px',
                                    color: 'white',
                                    cursor: saving ? 'not-allowed' : 'pointer',
                                    fontWeight: '500',
                                    display: 'flex',
                                    alignItems: 'center',
                                    gap: '6px',
                                }}
                            >
                                {saving ? <Icons.Loader /> : <Icons.Check />}
                                {template?.id ? 'Update Template' : 'Create Template'}
                            </button>
                        </div>
                    </div>
                </div>
            );
        };

        // Reframe Panel Component
        const ReframePanel = ({ clipId, onReframeComplete, onClose }) => {
            const [aspectRatio, setAspectRatio] = useState('9:16');
            const [trackingMode, setTrackingMode] = useState('speaker');
            const [processing, setProcessing] = useState(false);
            const [progress, setProgress] = useState(0);
            const [error, setError] = useState(null);
            const [previewUrl, setPreviewUrl] = useState(null);

            const handleReframe = async () => {
                setProcessing(true);
                setError(null);
                setProgress(0);

                try {
                    // Start reframe analysis
                    const result = await apiFetch(`/reframe/${clipId}`, {
                        method: 'POST',
                        body: JSON.stringify({
                            aspect_ratio: aspectRatio,
                            tracking_mode: trackingMode,
                        }),
                    });

                    // Poll for completion
                    const pollInterval = setInterval(async () => {
                        try {
                            const status = await apiFetch(`/reframe/${clipId}`);
                            setProgress(status.progress || 0);
                            if (status.status === 'completed') {
                                clearInterval(pollInterval);
                                setProcessing(false);
                                setPreviewUrl(status.preview_url);
                                onReframeComplete && onReframeComplete(status);
                            } else if (status.status === 'failed') {
                                clearInterval(pollInterval);
                                setProcessing(false);
                                setError(status.error || 'Reframe failed');
                            }
                        } catch (e) {
                            clearInterval(pollInterval);
                            setProcessing(false);
                            setError(e.message);
                        }
                    }, 1000);
                } catch (err) {
                    setError(err.message);
                    setProcessing(false);
                }
            };

            const selectedRatio = ASPECT_RATIOS.find(r => r.value === aspectRatio);

            return (
                <div style={{
                    background: 'var(--bg-surface)',
                    borderRadius: '16px',
                    padding: '20px',
                    border: '1px solid var(--border)',
                    marginBottom: '16px',
                }}>
                    <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center', marginBottom: '16px' }}>
                        <h4 style={{ fontSize: '16px', fontWeight: '600', display: 'flex', alignItems: 'center', gap: '8px' }}>
                            <Icons.Crop />
                            AI Reframe
                        </h4>
                        {onClose && (
                            <button onClick={onClose} style={{ background: 'none', border: 'none', color: 'var(--text-muted)', cursor: 'pointer' }}>
                                <Icons.X />
                            </button>
                        )}
                    </div>

                    {error && (
                        <div style={{ padding: '12px', background: 'rgba(239,68,68,0.1)', border: '1px solid var(--accent-red)', borderRadius: '8px', marginBottom: '16px', fontSize: '13px', color: 'var(--accent-red)' }}>
                            {error}
                        </div>
                    )}

                    {/* Aspect Ratio Selection */}
                    <div style={{ marginBottom: '16px' }}>
                        <label style={{ display: 'block', fontSize: '12px', color: 'var(--text-muted)', marginBottom: '8px' }}>
                            Target Aspect Ratio
                        </label>
                        <div style={{ display: 'flex', gap: '8px', flexWrap: 'wrap' }}>
                            {ASPECT_RATIOS.map(ratio => (
                                <button
                                    key={ratio.value}
                                    onClick={() => setAspectRatio(ratio.value)}
                                    style={{
                                        padding: '12px 16px',
                                        background: aspectRatio === ratio.value ? 'rgba(59,130,246,0.15)' : 'var(--bg-elevated)',
                                        border: aspectRatio === ratio.value ? '1px solid var(--accent-blue)' : '1px solid var(--border)',
                                        borderRadius: '10px',
                                        cursor: 'pointer',
                                        textAlign: 'center',
                                        minWidth: '90px',
                                    }}
                                >
                                    <div style={{ color: aspectRatio === ratio.value ? 'var(--accent-blue)' : 'var(--text-primary)', fontWeight: '600', marginBottom: '4px' }}>
                                        {ratio.label}
                                    </div>
                                    <div style={{ fontSize: '11px', color: 'var(--text-muted)' }}>
                                        {ratio.description}
                                    </div>
                                </button>
                            ))}
                        </div>
                    </div>

                    {/* Tracking Mode */}
                    <div style={{ marginBottom: '16px' }}>
                        <label style={{ display: 'block', fontSize: '12px', color: 'var(--text-muted)', marginBottom: '8px' }}>
                            Subject Tracking
                        </label>
                        <div style={{ display: 'grid', gridTemplateColumns: 'repeat(2, 1fr)', gap: '8px' }}>
                            {TRACKING_MODES.map(mode => (
                                <button
                                    key={mode.value}
                                    onClick={() => setTrackingMode(mode.value)}
                                    style={{
                                        padding: '10px 12px',
                                        background: trackingMode === mode.value ? 'rgba(168,85,247,0.15)' : 'var(--bg-elevated)',
                                        border: trackingMode === mode.value ? '1px solid var(--accent-purple)' : '1px solid var(--border)',
                                        borderRadius: '8px',
                                        cursor: 'pointer',
                                        textAlign: 'left',
                                    }}
                                >
                                    <div style={{ color: trackingMode === mode.value ? 'var(--accent-purple)' : 'var(--text-primary)', fontWeight: '500', fontSize: '13px' }}>
                                        {mode.label}
                                    </div>
                                    <div style={{ fontSize: '11px', color: 'var(--text-muted)' }}>
                                        {mode.description}
                                    </div>
                                </button>
                            ))}
                        </div>
                    </div>

                    {/* Progress */}
                    {processing && (
                        <div style={{ marginBottom: '16px' }}>
                            <div style={{ display: 'flex', justifyContent: 'space-between', marginBottom: '6px' }}>
                                <span style={{ fontSize: '13px', color: 'var(--text-muted)' }}>Processing...</span>
                                <span style={{ fontSize: '13px', color: 'var(--text-secondary)' }}>{Math.round(progress)}%</span>
                            </div>
                            <div style={{ background: 'var(--bg-elevated)', borderRadius: '4px', height: '6px', overflow: 'hidden' }}>
                                <div style={{ width: `${progress}%`, height: '100%', background: 'linear-gradient(90deg, var(--accent-purple), var(--accent-blue))', transition: 'width 0.3s' }} />
                            </div>
                        </div>
                    )}

                    {/* Action Button */}
                    <button
                        onClick={handleReframe}
                        disabled={processing}
                        style={{
                            width: '100%',
                            padding: '12px',
                            background: processing ? 'var(--bg-elevated)' : 'linear-gradient(135deg, var(--accent-purple) 0%, var(--accent-blue) 100%)',
                            border: 'none',
                            borderRadius: '10px',
                            color: processing ? 'var(--text-muted)' : 'white',
                            fontSize: '14px',
                            fontWeight: '600',
                            cursor: processing ? 'not-allowed' : 'pointer',
                            display: 'flex',
                            alignItems: 'center',
                            justifyContent: 'center',
                            gap: '8px',
                        }}
                    >
                        {processing ? <Icons.Loader /> : <Icons.Crop />}
                        {processing ? 'Reframing...' : `Reframe to ${aspectRatio}`}
                    </button>
                </div>
            );
        };

        // Thumbnail Gallery Component
        const ThumbnailGallery = ({ clipId, onSelect, onClose }) => {
            const [thumbnails, setThumbnails] = useState([]);
            const [loading, setLoading] = useState(false);
            const [generating, setGenerating] = useState(false);
            const [selectedId, setSelectedId] = useState(null);
            const [error, setError] = useState(null);

            const loadThumbnails = async () => {
                setLoading(true);
                try {
                    const result = await apiFetch(`/thumbnails/${clipId}`);
                    setThumbnails(result.thumbnails || []);
                } catch (err) {
                    setError(err.message);
                } finally {
                    setLoading(false);
                }
            };

            const generateThumbnails = async () => {
                setGenerating(true);
                setError(null);
                try {
                    await apiFetch(`/thumbnails/${clipId}/generate`, { method: 'POST', body: JSON.stringify({}) });
                    // Poll for completion
                    const pollInterval = setInterval(async () => {
                        try {
                            const result = await apiFetch(`/thumbnails/${clipId}`);
                            if (result.thumbnails && result.thumbnails.length > 0) {
                                clearInterval(pollInterval);
                                setThumbnails(result.thumbnails);
                                setGenerating(false);
                            }
                        } catch (e) {
                            clearInterval(pollInterval);
                            setError(e.message);
                            setGenerating(false);
                        }
                    }, 2000);
                } catch (err) {
                    setError(err.message);
                    setGenerating(false);
                }
            };

            useEffect(() => {
                loadThumbnails();
            }, [clipId]);

            const handleSelect = async (thumbnail) => {
                setSelectedId(thumbnail.id);
                try {
                    await apiFetch(`/thumbnails/${thumbnail.id}/select`, { method: 'POST' });
                    onSelect && onSelect(thumbnail);
                } catch (err) {
                    setError(err.message);
                }
            };

            return (
                <div style={{
                    background: 'var(--bg-surface)',
                    borderRadius: '16px',
                    padding: '20px',
                    border: '1px solid var(--border)',
                    marginBottom: '16px',
                }}>
                    <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center', marginBottom: '16px' }}>
                        <h4 style={{ fontSize: '16px', fontWeight: '600', display: 'flex', alignItems: 'center', gap: '8px' }}>
                            <Icons.Image />
                            Thumbnails
                        </h4>
                        <div style={{ display: 'flex', gap: '8px' }}>
                            <button
                                onClick={generateThumbnails}
                                disabled={generating}
                                style={{
                                    padding: '8px 12px',
                                    background: 'var(--accent-blue)',
                                    border: 'none',
                                    borderRadius: '6px',
                                    color: 'white',
                                    fontSize: '12px',
                                    cursor: generating ? 'not-allowed' : 'pointer',
                                    display: 'flex',
                                    alignItems: 'center',
                                    gap: '4px',
                                }}
                            >
                                {generating ? <Icons.Loader /> : <Icons.RotateCw />}
                                Generate
                            </button>
                            {onClose && (
                                <button onClick={onClose} style={{ background: 'none', border: 'none', color: 'var(--text-muted)', cursor: 'pointer' }}>
                                    <Icons.X />
                                </button>
                            )}
                        </div>
                    </div>

                    {error && (
                        <div style={{ padding: '12px', background: 'rgba(239,68,68,0.1)', border: '1px solid var(--accent-red)', borderRadius: '8px', marginBottom: '16px', fontSize: '13px', color: 'var(--accent-red)' }}>
                            {error}
                        </div>
                    )}

                    {loading ? (
                        <div style={{ textAlign: 'center', padding: '40px', color: 'var(--text-muted)' }}>
                            <Icons.Loader />
                            <div style={{ marginTop: '8px' }}>Loading thumbnails...</div>
                        </div>
                    ) : thumbnails.length === 0 ? (
                        <div style={{ textAlign: 'center', padding: '40px', color: 'var(--text-muted)' }}>
                            <Icons.Image />
                            <div style={{ marginTop: '8px' }}>No thumbnails yet. Click Generate to create them.</div>
                        </div>
                    ) : (
                        <div style={{ display: 'grid', gridTemplateColumns: 'repeat(auto-fill, minmax(150px, 1fr))', gap: '12px' }}>
                            {thumbnails.map(thumb => (
                                <div
                                    key={thumb.id}
                                    onClick={() => handleSelect(thumb)}
                                    style={{
                                        position: 'relative',
                                        borderRadius: '8px',
                                        overflow: 'hidden',
                                        border: selectedId === thumb.id ? '2px solid var(--accent-blue)' : '2px solid transparent',
                                        cursor: 'pointer',
                                        transition: 'all 0.2s',
                                    }}
                                >
                                    <img
                                        src={`${getApiBase()}/thumbnails/${thumb.id}/download`}
                                        alt={`Thumbnail at ${thumb.source_timestamp}s`}
                                        style={{ width: '100%', aspectRatio: '16/9', objectFit: 'cover', background: 'var(--bg-elevated)' }}
                                        onError={e => e.target.style.display = 'none'}
                                    />
                                    <div style={{
                                        position: 'absolute',
                                        bottom: 0,
                                        left: 0,
                                        right: 0,
                                        padding: '6px 8px',
                                        background: 'linear-gradient(transparent, rgba(0,0,0,0.8))',
                                        fontSize: '11px',
                                        display: 'flex',
                                        justifyContent: 'space-between',
                                    }}>
                                        <span>{Math.round(thumb.source_timestamp)}s</span>
                                        {thumb.engagement_score && (
                                            <span style={{ color: 'var(--accent-green)' }}>{Math.round(thumb.engagement_score)}%</span>
                                        )}
                                    </div>
                                    {selectedId === thumb.id && (
                                        <div style={{
                                            position: 'absolute',
                                            top: '8px',
                                            right: '8px',
                                            width: '24px',
                                            height: '24px',
                                            borderRadius: '50%',
                                            background: 'var(--accent-blue)',
                                            display: 'flex',
                                            alignItems: 'center',
                                            justifyContent: 'center',
                                        }}>
                                            <Icons.Check />
                                        </div>
                                    )}
                                </div>
                            ))}
                        </div>
                    )}
                </div>
            );
        };

        // Enhanced Export Options Modal
        const ExportOptionsModal = ({ clip, onExport, onClose }) => {
            const [captionStyles, setCaptionStyles] = useState([]);
            const [brandTemplates, setBrandTemplates] = useState([]);
            const [loading, setLoading] = useState(true);
            const [exporting, setExporting] = useState(false);
            const [error, setError] = useState(null);

            const [exportOptions, setExportOptions] = useState({
                format: 'mp4',
                caption_style_id: null,
                brand_template_id: null,
                aspect_ratio: null,
                include_captions: false,
                include_branding: false,
                include_outro: false,
            });

            useEffect(() => {
                const loadData = async () => {
                    setLoading(true);
                    try {
                        const [styles, brands] = await Promise.all([
                            apiFetch('/captions/styles').catch(() => ({ styles: [] })),
                            apiFetch('/brands').catch(() => ({ templates: [] })),
                        ]);
                        setCaptionStyles(styles.styles || styles || []);
                        setBrandTemplates(brands.templates || brands || []);
                    } catch (err) {
                        console.error('Error loading export options:', err);
                    } finally {
                        setLoading(false);
                    }
                };
                loadData();
            }, []);

            const handleExport = async () => {
                setExporting(true);
                setError(null);
                try {
                    const result = await apiFetch(`/clips/${clip.id}/export/enhanced`, {
                        method: 'POST',
                        body: JSON.stringify(exportOptions),
                    });
                    onExport && onExport(result);
                    onClose();
                } catch (err) {
                    setError(err.message);
                } finally {
                    setExporting(false);
                }
            };

            return (
                <div style={{
                    position: 'fixed',
                    top: 0, left: 0, right: 0, bottom: 0,
                    background: 'rgba(0,0,0,0.7)',
                    display: 'flex',
                    alignItems: 'center',
                    justifyContent: 'center',
                    zIndex: 1000,
                }} onClick={onClose}>
                    <div style={{
                        background: 'var(--bg-surface)',
                        borderRadius: '16px',
                        padding: '24px',
                        width: '90%',
                        maxWidth: '500px',
                        maxHeight: '85vh',
                        overflow: 'auto',
                        border: '1px solid var(--border)',
                    }} onClick={e => e.stopPropagation()}>
                        <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center', marginBottom: '20px' }}>
                            <h3 style={{ fontSize: '18px', fontWeight: '600', display: 'flex', alignItems: 'center', gap: '8px' }}>
                                <Icons.Download />
                                Export Options
                            </h3>
                            <button onClick={onClose} style={{ background: 'none', border: 'none', color: 'var(--text-muted)', cursor: 'pointer' }}>
                                <Icons.X />
                            </button>
                        </div>

                        {error && (
                            <div style={{ padding: '12px', background: 'rgba(239,68,68,0.1)', border: '1px solid var(--accent-red)', borderRadius: '8px', marginBottom: '16px', fontSize: '13px', color: 'var(--accent-red)' }}>
                                {error}
                            </div>
                        )}

                        {loading ? (
                            <div style={{ textAlign: 'center', padding: '40px', color: 'var(--text-muted)' }}>
                                <Icons.Loader />
                                <div style={{ marginTop: '8px' }}>Loading options...</div>
                            </div>
                        ) : (
                            <div>
                                {/* Format Selection */}
                                <div style={{ marginBottom: '20px' }}>
                                    <label style={{ display: 'block', fontSize: '14px', fontWeight: '500', marginBottom: '8px' }}>
                                        Export Format
                                    </label>
                                    <div style={{ display: 'flex', gap: '8px' }}>
                                        {['mp4', 'webm', 'mov'].map(fmt => (
                                            <button
                                                key={fmt}
                                                onClick={() => setExportOptions({ ...exportOptions, format: fmt })}
                                                style={{
                                                    padding: '10px 20px',
                                                    background: exportOptions.format === fmt ? 'var(--accent-blue)' : 'var(--bg-elevated)',
                                                    border: '1px solid var(--border)',
                                                    borderRadius: '8px',
                                                    color: exportOptions.format === fmt ? 'white' : 'var(--text-secondary)',
                                                    cursor: 'pointer',
                                                    fontWeight: '500',
                                                    textTransform: 'uppercase',
                                                }}
                                            >
                                                {fmt}
                                            </button>
                                        ))}
                                    </div>
                                </div>

                                {/* Captions */}
                                <div style={{ marginBottom: '20px', padding: '16px', background: 'var(--bg-elevated)', borderRadius: '12px' }}>
                                    <label style={{ display: 'flex', alignItems: 'center', gap: '8px', cursor: 'pointer', marginBottom: '12px' }}>
                                        <input
                                            type="checkbox"
                                            checked={exportOptions.include_captions}
                                            onChange={e => setExportOptions({ ...exportOptions, include_captions: e.target.checked })}
                                        />
                                        <Icons.Type />
                                        <span style={{ fontWeight: '500' }}>Include Animated Captions</span>
                                    </label>

                                    {exportOptions.include_captions && captionStyles.length > 0 && (
                                        <select
                                            value={exportOptions.caption_style_id || ''}
                                            onChange={e => setExportOptions({ ...exportOptions, caption_style_id: e.target.value || null })}
                                            style={{
                                                width: '100%',
                                                padding: '10px 12px',
                                                background: 'var(--bg-base)',
                                                border: '1px solid var(--border)',
                                                borderRadius: '8px',
                                                color: 'var(--text-primary)',
                                                fontSize: '14px',
                                            }}
                                        >
                                            <option value="">Select caption style...</option>
                                            {captionStyles.map(style => (
                                                <option key={style.id} value={style.id}>{style.name}</option>
                                            ))}
                                        </select>
                                    )}

                                    {exportOptions.include_captions && captionStyles.length === 0 && (
                                        <div style={{ fontSize: '13px', color: 'var(--text-muted)', fontStyle: 'italic' }}>
                                            No caption styles created yet. Create one in the Pro Features tab.
                                        </div>
                                    )}
                                </div>

                                {/* Branding */}
                                <div style={{ marginBottom: '20px', padding: '16px', background: 'var(--bg-elevated)', borderRadius: '12px' }}>
                                    <label style={{ display: 'flex', alignItems: 'center', gap: '8px', cursor: 'pointer', marginBottom: '12px' }}>
                                        <input
                                            type="checkbox"
                                            checked={exportOptions.include_branding}
                                            onChange={e => setExportOptions({ ...exportOptions, include_branding: e.target.checked })}
                                        />
                                        <Icons.Award />
                                        <span style={{ fontWeight: '500' }}>Apply Brand Template</span>
                                    </label>

                                    {exportOptions.include_branding && brandTemplates.length > 0 && (
                                        <div>
                                            <select
                                                value={exportOptions.brand_template_id || ''}
                                                onChange={e => setExportOptions({ ...exportOptions, brand_template_id: e.target.value || null })}
                                                style={{
                                                    width: '100%',
                                                    padding: '10px 12px',
                                                    background: 'var(--bg-base)',
                                                    border: '1px solid var(--border)',
                                                    borderRadius: '8px',
                                                    color: 'var(--text-primary)',
                                                    fontSize: '14px',
                                                    marginBottom: '12px',
                                                }}
                                            >
                                                <option value="">Select brand template...</option>
                                                {brandTemplates.map(brand => (
                                                    <option key={brand.id} value={brand.id}>{brand.name}</option>
                                                ))}
                                            </select>

                                            <label style={{ display: 'flex', alignItems: 'center', gap: '8px', cursor: 'pointer', fontSize: '13px', color: 'var(--text-secondary)' }}>
                                                <input
                                                    type="checkbox"
                                                    checked={exportOptions.include_outro}
                                                    onChange={e => setExportOptions({ ...exportOptions, include_outro: e.target.checked })}
                                                />
                                                Include outro screen
                                            </label>
                                        </div>
                                    )}

                                    {exportOptions.include_branding && brandTemplates.length === 0 && (
                                        <div style={{ fontSize: '13px', color: 'var(--text-muted)', fontStyle: 'italic' }}>
                                            No brand templates created yet. Create one in the Pro Features tab.
                                        </div>
                                    )}
                                </div>

                                {/* Aspect Ratio */}
                                <div style={{ marginBottom: '20px' }}>
                                    <label style={{ display: 'block', fontSize: '14px', fontWeight: '500', marginBottom: '8px' }}>
                                        Reframe to Aspect Ratio (optional)
                                    </label>
                                    <div style={{ display: 'flex', gap: '8px', flexWrap: 'wrap' }}>
                                        <button
                                            onClick={() => setExportOptions({ ...exportOptions, aspect_ratio: null })}
                                            style={{
                                                padding: '8px 14px',
                                                background: !exportOptions.aspect_ratio ? 'var(--accent-blue)' : 'var(--bg-elevated)',
                                                border: '1px solid var(--border)',
                                                borderRadius: '6px',
                                                color: !exportOptions.aspect_ratio ? 'white' : 'var(--text-secondary)',
                                                cursor: 'pointer',
                                                fontSize: '13px',
                                            }}
                                        >
                                            Original
                                        </button>
                                        {ASPECT_RATIOS.map(ratio => (
                                            <button
                                                key={ratio.value}
                                                onClick={() => setExportOptions({ ...exportOptions, aspect_ratio: ratio.value })}
                                                style={{
                                                    padding: '8px 14px',
                                                    background: exportOptions.aspect_ratio === ratio.value ? 'var(--accent-blue)' : 'var(--bg-elevated)',
                                                    border: '1px solid var(--border)',
                                                    borderRadius: '6px',
                                                    color: exportOptions.aspect_ratio === ratio.value ? 'white' : 'var(--text-secondary)',
                                                    cursor: 'pointer',
                                                    fontSize: '13px',
                                                }}
                                            >
                                                {ratio.label}
                                            </button>
                                        ))}
                                    </div>
                                </div>

                                {/* Export Button */}
                                <button
                                    onClick={handleExport}
                                    disabled={exporting}
                                    style={{
                                        width: '100%',
                                        padding: '14px',
                                        background: exporting ? 'var(--bg-elevated)' : 'linear-gradient(135deg, var(--accent-purple) 0%, var(--accent-blue) 100%)',
                                        border: 'none',
                                        borderRadius: '10px',
                                        color: exporting ? 'var(--text-muted)' : 'white',
                                        fontSize: '15px',
                                        fontWeight: '600',
                                        cursor: exporting ? 'not-allowed' : 'pointer',
                                        display: 'flex',
                                        alignItems: 'center',
                                        justifyContent: 'center',
                                        gap: '8px',
                                    }}
                                >
                                    {exporting ? <Icons.Loader /> : <Icons.Download />}
                                    {exporting ? 'Exporting...' : 'Export Clip'}
                                </button>
                            </div>
                        )}
                    </div>
                </div>
            );
        };

        // Pro Features Page Component
        const ProFeaturesPage = () => {
            const [activeSection, setActiveSection] = useState('captions');
            const [captionStyles, setCaptionStyles] = useState([]);
            const [brandTemplates, setBrandTemplates] = useState([]);
            const [loading, setLoading] = useState(true);
            const [editingCaptionStyle, setEditingCaptionStyle] = useState(null);
            const [editingBrandTemplate, setEditingBrandTemplate] = useState(null);
            const [showCaptionEditor, setShowCaptionEditor] = useState(false);
            const [showBrandEditor, setShowBrandEditor] = useState(false);
            const [error, setError] = useState(null);

            const loadData = async () => {
                setLoading(true);
                try {
                    const [styles, brands] = await Promise.all([
                        apiFetch('/captions/styles').catch(() => []),
                        apiFetch('/brands').catch(() => []),
                    ]);
                    setCaptionStyles(Array.isArray(styles) ? styles : styles.styles || []);
                    setBrandTemplates(Array.isArray(brands) ? brands : brands.templates || []);
                } catch (err) {
                    setError(err.message);
                } finally {
                    setLoading(false);
                }
            };

            useEffect(() => {
                loadData();
            }, []);

            const handleDeleteCaptionStyle = async (id) => {
                if (!confirm('Delete this caption style?')) return;
                try {
                    await apiFetch(`/captions/styles/${id}`, { method: 'DELETE' });
                    setCaptionStyles(prev => prev.filter(s => s.id !== id));
                } catch (err) {
                    setError(err.message);
                }
            };

            const handleDeleteBrandTemplate = async (id) => {
                if (!confirm('Delete this brand template?')) return;
                try {
                    await apiFetch(`/brands/${id}`, { method: 'DELETE' });
                    setBrandTemplates(prev => prev.filter(b => b.id !== id));
                } catch (err) {
                    setError(err.message);
                }
            };

            const sections = [
                { id: 'captions', label: 'Caption Styles', icon: Icons.Type },
                { id: 'brands', label: 'Brand Templates', icon: Icons.Award },
            ];

            return (
                <div className="animate-in">
                    {/* Header */}
                    <div style={{
                        background: 'linear-gradient(135deg, rgba(168,85,247,0.1) 0%, rgba(59,130,246,0.1) 100%)',
                        borderRadius: '16px',
                        padding: '24px',
                        marginBottom: '20px',
                        border: '1px solid var(--border)',
                    }}>
                        <div style={{ display: 'flex', alignItems: 'center', gap: '12px' }}>
                            <div style={{
                                width: '40px',
                                height: '40px',
                                borderRadius: '10px',
                                background: 'linear-gradient(135deg, var(--accent-purple) 0%, var(--accent-blue) 100%)',
                                display: 'flex',
                                alignItems: 'center',
                                justifyContent: 'center',
                            }}>
                                <Icons.Sparkles />
                            </div>
                            <div>
                                <h2 style={{ fontSize: '20px', fontWeight: '600' }}>Pro Features</h2>
                                <p style={{ fontSize: '13px', color: 'var(--text-muted)' }}>
                                    Manage caption styles, brand templates, and export settings
                                </p>
                            </div>
                        </div>
                    </div>

                    {/* Section Tabs */}
                    <div style={{
                        display: 'flex',
                        gap: '8px',
                        marginBottom: '20px',
                        background: 'var(--bg-surface)',
                        padding: '4px',
                        borderRadius: '10px',
                        width: 'fit-content',
                    }}>
                        {sections.map(section => (
                            <button
                                key={section.id}
                                onClick={() => setActiveSection(section.id)}
                                style={{
                                    padding: '10px 20px',
                                    background: activeSection === section.id ? 'var(--bg-elevated)' : 'transparent',
                                    border: 'none',
                                    borderRadius: '8px',
                                    color: activeSection === section.id ? 'var(--text-primary)' : 'var(--text-secondary)',
                                    cursor: 'pointer',
                                    display: 'flex',
                                    alignItems: 'center',
                                    gap: '8px',
                                    fontSize: '14px',
                                    fontWeight: '500',
                                }}
                            >
                                <section.icon />
                                {section.label}
                            </button>
                        ))}
                    </div>

                    {error && (
                        <div style={{ padding: '16px', background: 'rgba(239,68,68,0.1)', border: '1px solid var(--accent-red)', borderRadius: '12px', marginBottom: '20px' }}>
                            {error}
                            <button onClick={() => setError(null)} style={{ marginLeft: '12px', background: 'none', border: 'none', color: 'var(--text-muted)', cursor: 'pointer' }}>
                                <Icons.X />
                            </button>
                        </div>
                    )}

                    {loading ? (
                        <div style={{ textAlign: 'center', padding: '60px', color: 'var(--text-muted)' }}>
                            <Icons.Loader />
                            <div style={{ marginTop: '12px' }}>Loading...</div>
                        </div>
                    ) : (
                        <>
                            {/* Caption Styles Section */}
                            {activeSection === 'captions' && (
                                <div style={{ background: 'var(--bg-surface)', borderRadius: '16px', padding: '24px', border: '1px solid var(--border)' }}>
                                    <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center', marginBottom: '20px' }}>
                                        <h3 style={{ fontSize: '18px', fontWeight: '600' }}>Caption Styles</h3>
                                        <button
                                            onClick={() => { setEditingCaptionStyle(null); setShowCaptionEditor(true); }}
                                            style={{
                                                padding: '10px 16px',
                                                background: 'var(--accent-blue)',
                                                border: 'none',
                                                borderRadius: '8px',
                                                color: 'white',
                                                cursor: 'pointer',
                                                display: 'flex',
                                                alignItems: 'center',
                                                gap: '6px',
                                                fontSize: '13px',
                                                fontWeight: '500',
                                            }}
                                        >
                                            <Icons.Plus />
                                            New Style
                                        </button>
                                    </div>

                                    {captionStyles.length === 0 ? (
                                        <div style={{ textAlign: 'center', padding: '40px', color: 'var(--text-muted)' }}>
                                            <Icons.Type />
                                            <div style={{ marginTop: '12px' }}>No caption styles yet. Create your first one!</div>
                                        </div>
                                    ) : (
                                        <div style={{ display: 'grid', gridTemplateColumns: 'repeat(auto-fill, minmax(280px, 1fr))', gap: '16px' }}>
                                            {captionStyles.map(style => (
                                                <div
                                                    key={style.id}
                                                    style={{
                                                        background: 'var(--bg-elevated)',
                                                        borderRadius: '12px',
                                                        padding: '16px',
                                                        border: '1px solid var(--border)',
                                                    }}
                                                >
                                                    <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'start', marginBottom: '12px' }}>
                                                        <div>
                                                            <h4 style={{ fontSize: '15px', fontWeight: '600', marginBottom: '4px' }}>{style.name}</h4>
                                                            <span style={{
                                                                padding: '3px 8px',
                                                                background: 'rgba(168,85,247,0.15)',
                                                                color: 'var(--accent-purple)',
                                                                borderRadius: '4px',
                                                                fontSize: '11px',
                                                                textTransform: 'capitalize',
                                                            }}>
                                                                {style.style_type}
                                                            </span>
                                                        </div>
                                                    </div>

                                                    <div style={{ display: 'flex', gap: '6px', marginBottom: '12px' }}>
                                                        <div style={{ width: '20px', height: '20px', borderRadius: '4px', background: style.text_color, border: '1px solid var(--border)' }} title="Text" />
                                                        <div style={{ width: '20px', height: '20px', borderRadius: '4px', background: style.highlight_color, border: '1px solid var(--border)' }} title="Highlight" />
                                                        <div style={{ width: '20px', height: '20px', borderRadius: '4px', background: style.stroke_color, border: '1px solid var(--border)' }} title="Stroke" />
                                                    </div>

                                                    <div style={{ fontSize: '12px', color: 'var(--text-muted)', marginBottom: '12px' }}>
                                                        {style.font_family}  {style.font_size}px  {style.position}
                                                    </div>

                                                    <div style={{ display: 'flex', gap: '8px' }}>
                                                        <button
                                                            onClick={() => { setEditingCaptionStyle(style); setShowCaptionEditor(true); }}
                                                            style={{
                                                                flex: 1,
                                                                padding: '8px',
                                                                background: 'var(--bg-base)',
                                                                border: '1px solid var(--border)',
                                                                borderRadius: '6px',
                                                                color: 'var(--text-secondary)',
                                                                cursor: 'pointer',
                                                                display: 'flex',
                                                                alignItems: 'center',
                                                                justifyContent: 'center',
                                                                gap: '4px',
                                                                fontSize: '12px',
                                                            }}
                                                        >
                                                            <Icons.Edit /> Edit
                                                        </button>
                                                        <button
                                                            onClick={() => handleDeleteCaptionStyle(style.id)}
                                                            style={{
                                                                padding: '8px 12px',
                                                                background: 'rgba(239,68,68,0.1)',
                                                                border: '1px solid rgba(239,68,68,0.2)',
                                                                borderRadius: '6px',
                                                                color: 'var(--accent-red)',
                                                                cursor: 'pointer',
                                                            }}
                                                        >
                                                            <Icons.Trash />
                                                        </button>
                                                    </div>
                                                </div>
                                            ))}
                                        </div>
                                    )}
                                </div>
                            )}

                            {/* Brand Templates Section */}
                            {activeSection === 'brands' && (
                                <div style={{ background: 'var(--bg-surface)', borderRadius: '16px', padding: '24px', border: '1px solid var(--border)' }}>
                                    <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center', marginBottom: '20px' }}>
                                        <h3 style={{ fontSize: '18px', fontWeight: '600' }}>Brand Templates</h3>
                                        <button
                                            onClick={() => { setEditingBrandTemplate(null); setShowBrandEditor(true); }}
                                            style={{
                                                padding: '10px 16px',
                                                background: 'var(--accent-blue)',
                                                border: 'none',
                                                borderRadius: '8px',
                                                color: 'white',
                                                cursor: 'pointer',
                                                display: 'flex',
                                                alignItems: 'center',
                                                gap: '6px',
                                                fontSize: '13px',
                                                fontWeight: '500',
                                            }}
                                        >
                                            <Icons.Plus />
                                            New Template
                                        </button>
                                    </div>

                                    {brandTemplates.length === 0 ? (
                                        <div style={{ textAlign: 'center', padding: '40px', color: 'var(--text-muted)' }}>
                                            <Icons.Award />
                                            <div style={{ marginTop: '12px' }}>No brand templates yet. Create your first one!</div>
                                        </div>
                                    ) : (
                                        <div style={{ display: 'grid', gridTemplateColumns: 'repeat(auto-fill, minmax(280px, 1fr))', gap: '16px' }}>
                                            {brandTemplates.map(brand => (
                                                <div
                                                    key={brand.id}
                                                    style={{
                                                        background: 'var(--bg-elevated)',
                                                        borderRadius: '12px',
                                                        padding: '16px',
                                                        border: '1px solid var(--border)',
                                                    }}
                                                >
                                                    <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'start', marginBottom: '12px' }}>
                                                        <div>
                                                            <h4 style={{ fontSize: '15px', fontWeight: '600', marginBottom: '4px' }}>{brand.name}</h4>
                                                            {brand.is_default && (
                                                                <span style={{
                                                                    padding: '3px 8px',
                                                                    background: 'rgba(234,179,8,0.15)',
                                                                    color: 'var(--accent-yellow)',
                                                                    borderRadius: '4px',
                                                                    fontSize: '11px',
                                                                }}>
                                                                    <Icons.Star /> Default
                                                                </span>
                                                            )}
                                                        </div>
                                                    </div>

                                                    <div style={{ display: 'flex', gap: '6px', marginBottom: '12px' }}>
                                                        <div style={{ width: '24px', height: '24px', borderRadius: '4px', background: brand.primary_color, border: '1px solid var(--border)' }} title="Primary" />
                                                        <div style={{ width: '24px', height: '24px', borderRadius: '4px', background: brand.secondary_color, border: '1px solid var(--border)' }} title="Secondary" />
                                                        <div style={{ width: '24px', height: '24px', borderRadius: '4px', background: brand.accent_color, border: '1px solid var(--border)' }} title="Accent" />
                                                    </div>

                                                    <div style={{ fontSize: '12px', color: 'var(--text-muted)', marginBottom: '12px' }}>
                                                        Logo: {brand.logo_position?.replace('_', ' ')}  Size: {brand.logo_size}px
                                                        {brand.outro_enabled && '  Outro enabled'}
                                                    </div>

                                                    <div style={{ display: 'flex', gap: '8px' }}>
                                                        <button
                                                            onClick={() => { setEditingBrandTemplate(brand); setShowBrandEditor(true); }}
                                                            style={{
                                                                flex: 1,
                                                                padding: '8px',
                                                                background: 'var(--bg-base)',
                                                                border: '1px solid var(--border)',
                                                                borderRadius: '6px',
                                                                color: 'var(--text-secondary)',
                                                                cursor: 'pointer',
                                                                display: 'flex',
                                                                alignItems: 'center',
                                                                justifyContent: 'center',
                                                                gap: '4px',
                                                                fontSize: '12px',
                                                            }}
                                                        >
                                                            <Icons.Edit /> Edit
                                                        </button>
                                                        <button
                                                            onClick={() => handleDeleteBrandTemplate(brand.id)}
                                                            style={{
                                                                padding: '8px 12px',
                                                                background: 'rgba(239,68,68,0.1)',
                                                                border: '1px solid rgba(239,68,68,0.2)',
                                                                borderRadius: '6px',
                                                                color: 'var(--accent-red)',
                                                                cursor: 'pointer',
                                                            }}
                                                        >
                                                            <Icons.Trash />
                                                        </button>
                                                    </div>
                                                </div>
                                            ))}
                                        </div>
                                    )}
                                </div>
                            )}
                        </>
                    )}

                    {/* Modals */}
                    {showCaptionEditor && (
                        <CaptionStyleEditor
                            style={editingCaptionStyle}
                            onSave={(saved) => {
                                if (editingCaptionStyle) {
                                    setCaptionStyles(prev => prev.map(s => s.id === saved.id ? saved : s));
                                } else {
                                    setCaptionStyles(prev => [...prev, saved]);
                                }
                                setShowCaptionEditor(false);
                            }}
                            onClose={() => setShowCaptionEditor(false)}
                        />
                    )}

                    {showBrandEditor && (
                        <BrandTemplateEditor
                            template={editingBrandTemplate}
                            onSave={(saved) => {
                                if (editingBrandTemplate) {
                                    setBrandTemplates(prev => prev.map(b => b.id === saved.id ? saved : b));
                                } else {
                                    setBrandTemplates(prev => [...prev, saved]);
                                }
                                setShowBrandEditor(false);
                            }}
                            onClose={() => setShowBrandEditor(false)}
                        />
                    )}
                </div>
            );
        };

        // ============== AI ANALYSIS PAGE ==============

        const AIAnalysisPage = () => {
            const [apiBase, setApiBase] = useState(getApiBase);
            const [downloadDir, setDownloadDir] = useState(getDownloadDir);
            const [showSettings, setShowSettings] = useState(false);
            const [apiUrlInput, setApiUrlInput] = useState(getApiBase);
            const [downloadDirInput, setDownloadDirInput] = useState(getDownloadDir);
            const [connectionStatus, setConnectionStatus] = useState('checking'); // 'checking', 'connected', 'disconnected'
            const [videoUrl, setVideoUrl] = useState('');
            const [videoFile, setVideoFile] = useState(null);
            const [uploadProgress, setUploadProgress] = useState(0);
            const [videoId, setVideoId] = useState(null);
            const [jobId, setJobId] = useState(null);
            const [analysisStatus, setAnalysisStatus] = useState(null);
            const [analysisProgress, setAnalysisProgress] = useState(0);
            const [results, setResults] = useState(null);
            const [error, setError] = useState(null);
            const [isLoading, setIsLoading] = useState(false);
            const [exportingClip, setExportingClip] = useState(null);
            const [showReframe, setShowReframe] = useState(null);
            const [showThumbnails, setShowThumbnails] = useState(null);

            // Check backend connection on mount and when API URL changes
            useEffect(() => {
                const checkConnection = async () => {
                    setConnectionStatus('checking');
                    try {
                        // Extract base URL (remove /api/v1)
                        const baseUrl = apiBase.replace(/\/api\/v1\/?$/, '');
                        const response = await fetch(`${baseUrl}/health`, {
                            method: 'GET',
                            signal: AbortSignal.timeout(5000)
                        });
                        if (response.ok) {
                            setConnectionStatus('connected');
                        } else {
                            setConnectionStatus('disconnected');
                        }
                    } catch (err) {
                        setConnectionStatus('disconnected');
                    }
                };
                checkConnection();
            }, [apiBase]);

            // Save settings to localStorage
            const saveSettings = () => {
                const url = apiUrlInput.trim();
                if (url) {
                    localStorage.setItem('vep-api-url', url);
                    setApiBase(url);
                }
                const dir = downloadDirInput.trim();
                localStorage.setItem('vep-download-dir', dir);
                setDownloadDir(dir);
                setShowSettings(false);
            };

            // Handle file upload
            const handleFileUpload = async (e) => {
                const file = e.target.files[0];
                if (!file) return;

                setVideoFile(file);
                setError(null);
                setIsLoading(true);
                setUploadProgress(0);

                const formData = new FormData();
                formData.append('file', file);

                try {
                    const response = await fetch(`${apiBase}/videos/upload`, {
                        method: 'POST',
                        body: formData,
                    });

                    if (!response.ok) {
                        const err = await response.json();
                        throw new Error(err.detail || 'Upload failed');
                    }

                    const video = await response.json();
                    setVideoId(video.id);
                    setUploadProgress(100);
                } catch (err) {
                    setError(err.message);
                } finally {
                    setIsLoading(false);
                }
            };

            // Extract URL from text (handles pasted commands)
            const extractUrl = (text) => {
                // Match common video platform URLs
                const urlPattern = /(https?:\/\/(?:www\.)?(?:youtube\.com\/watch\?v=[\w-]+|youtu\.be\/[\w-]+|vimeo\.com\/\d+|twitter\.com\/\w+\/status\/\d+|x\.com\/\w+\/status\/\d+|tiktok\.com\/@[\w.]+\/video\/\d+|instagram\.com\/(?:p|reel)\/[\w-]+|twitch\.tv\/videos\/\d+|dailymotion\.com\/video\/[\w-]+|facebook\.com\/[\w.]+\/videos\/\d+)[^\s"']*)|(https?:\/\/[^\s"']+)/gi;
                const matches = text.match(urlPattern);
                return matches ? matches[0] : text.trim();
            };

            // Poll video status until ready
            const waitForVideo = async (id) => {
                const maxAttempts = 120; // 2 minutes max
                for (let i = 0; i < maxAttempts; i++) {
                    await new Promise(r => setTimeout(r, 1000));
                    try {
                        const res = await fetch(`${apiBase}/videos/${id}`);
                        const video = await res.json();

                        if (video.status === 'ready') {
                            return video;
                        } else if (video.status === 'error') {
                            throw new Error(video.error_message || 'Download failed');
                        }
                        // Still downloading, continue polling
                        setAnalysisStatus(`Downloading... ${video.title || ''}`);
                    } catch (err) {
                        throw err;
                    }
                }
                throw new Error('Download timeout');
            };

            // Handle URL submission - downloads, waits, then auto-analyzes
            const handleUrlSubmit = async () => {
                if (!videoUrl) return;

                setError(null);
                setIsLoading(true);
                setAnalysisStatus('Starting download...');
                setAnalysisProgress(0);
                setResults(null);

                // Extract actual URL if user pasted a command
                const cleanUrl = extractUrl(videoUrl);

                try {
                    // Step 1: Start download
                    const downloadPayload = { url: cleanUrl };
                    if (downloadDir) {
                        downloadPayload.output_dir = downloadDir;
                    }
                    const response = await fetch(`${apiBase}/videos/download`, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(downloadPayload),
                    });

                    if (!response.ok) {
                        const err = await response.json();
                        throw new Error(err.detail || 'Download failed');
                    }

                    const video = await response.json();
                    setVideoId(video.id);

                    // Step 2: Wait for download to complete
                    setAnalysisStatus('Downloading video...');
                    const readyVideo = await waitForVideo(video.id);

                    // Step 3: Auto-start analysis
                    setAnalysisStatus('Starting AI analysis...');
                    await startAnalysisForVideo(video.id);

                } catch (err) {
                    setError(err.message);
                    setIsLoading(false);
                    setAnalysisStatus(null);
                }
            };

            // Start analysis for a specific video ID
            const startAnalysisForVideo = async (vidId) => {
                try {
                    setIsLoading(true);
                    setError(null);
                    setAnalysisStatus('Starting analysis...');
                    setAnalysisProgress(0);

                    const response = await fetch(`${apiBase}/analysis/${vidId}/start`, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({
                            transcribe: true,
                            diarize: false,
                            detect_scenes: true,
                            analyze_visuals: true,
                            detect_hooks: true,
                            suggest_clips: true,
                            llm_analysis: true,
                        }),
                    });

                    if (!response.ok) {
                        const err = await response.json();
                        throw new Error(err.detail || 'Failed to start analysis');
                    }

                    const job = await response.json();
                    setJobId(job.id);

                    // Poll for analysis progress
                    pollAnalysisStatus(job.id);
                } catch (err) {
                    setError(err.message);
                    setAnalysisStatus(null);
                    setIsLoading(false);
                }
            };

            // Poll analysis status
            const pollAnalysisStatus = async (id) => {
                const poll = async () => {
                    try {
                        const response = await fetch(`${apiBase}/analysis/${id}/status`);
                        const data = await response.json();
                        setAnalysisStatus(data.current_stage || data.status);
                        setAnalysisProgress(data.progress);

                        if (data.status === 'completed') {
                            fetchResults(id);
                        } else if (data.status === 'failed') {
                            setError(data.error_message || 'Analysis failed');
                            setIsLoading(false);
                        } else {
                            setTimeout(poll, 1000);
                        }
                    } catch (err) {
                        setError('Lost connection to server');
                        setIsLoading(false);
                    }
                };
                poll();
            };

            // Fetch results
            const fetchResults = async (id) => {
                try {
                    const response = await fetch(`${apiBase}/analysis/${id}/full`);
                    const data = await response.json();
                    setResults(data);
                } catch (err) {
                    setError(err.message);
                } finally {
                    setIsLoading(false);
                }
            };

            // Export clip
            const exportClip = async (clipId) => {
                try {
                    setAnalysisStatus('Exporting clip...');

                    // Start export
                    const response = await fetch(`${apiBase}/clips/${clipId}/export`, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ clip_id: clipId, format: 'mp4' }),
                    });

                    if (!response.ok) {
                        throw new Error('Failed to start export');
                    }

                    // Poll for export completion
                    const pollExport = async () => {
                        for (let i = 0; i < 60; i++) { // Max 60 seconds
                            const detailRes = await fetch(`${apiBase}/clips/detail/${clipId}`);
                            if (detailRes.ok) {
                                const clip = await detailRes.json();
                                if (clip.exported && clip.export_path) {
                                    // Export complete, update results and trigger download
                                    setAnalysisStatus(null);
                                    if (results && results.clips) {
                                        setResults({
                                            ...results,
                                            clips: results.clips.map(c =>
                                                c.id === clipId ? { ...c, exported: true, export_path: clip.export_path } : c
                                            )
                                        });
                                    }
                                    window.open(`${apiBase}/clips/${clipId}/download`, '_blank');
                                    return;
                                }
                            }
                            await new Promise(r => setTimeout(r, 1000));
                            setAnalysisStatus(`Exporting clip... ${i + 1}s`);
                        }
                        throw new Error('Export timeout');
                    };

                    await pollExport();
                } catch (err) {
                    setError(err.message);
                    setAnalysisStatus(null);
                }
            };

            // Reset state
            const resetState = () => {
                setVideoUrl('');
                setVideoFile(null);
                setVideoId(null);
                setJobId(null);
                setAnalysisStatus(null);
                setAnalysisProgress(0);
                setResults(null);
                setError(null);
                setIsLoading(false);
            };

            const formatDuration = (seconds) => {
                const mins = Math.floor(seconds / 60);
                const secs = Math.floor(seconds % 60);
                return `${mins}:${secs.toString().padStart(2, '0')}`;
            };

            const getStatusColor = (status) => {
                switch (status) {
                    case 'completed': return 'var(--accent-green)';
                    case 'failed': return 'var(--accent-red)';
                    case 'processing': return 'var(--accent-blue)';
                    default: return 'var(--accent-yellow)';
                }
            };

            return (
                <div className="animate-in">
                    {/* Settings Modal */}
                    {showSettings && (
                        <div style={{
                            position: 'fixed',
                            top: 0,
                            left: 0,
                            right: 0,
                            bottom: 0,
                            background: 'rgba(0,0,0,0.5)',
                            display: 'flex',
                            alignItems: 'center',
                            justifyContent: 'center',
                            zIndex: 1000
                        }} onClick={() => setShowSettings(false)}>
                            <div style={{
                                background: 'var(--bg-surface)',
                                borderRadius: '16px',
                                padding: '24px',
                                width: '90%',
                                maxWidth: '450px',
                                border: '1px solid var(--border)'
                            }} onClick={e => e.stopPropagation()}>
                                <h3 style={{ fontSize: '18px', fontWeight: '600', marginBottom: '16px', display: 'flex', alignItems: 'center', gap: '8px' }}>
                                    <Icons.Settings />
                                    Settings
                                </h3>
                                <div style={{ marginBottom: '16px' }}>
                                    <label style={{ fontSize: '13px', color: 'var(--text-muted)', display: 'block', marginBottom: '8px' }}>
                                        Download Directory
                                    </label>
                                    <input
                                        type="text"
                                        value={downloadDirInput}
                                        onChange={e => setDownloadDirInput(e.target.value)}
                                        placeholder="D:\Videos\Downloads (leave empty for default)"
                                        style={{
                                            width: '100%',
                                            padding: '12px 16px',
                                            background: 'var(--bg-elevated)',
                                            border: '1px solid var(--border)',
                                            borderRadius: '8px',
                                            color: 'var(--text)',
                                            fontSize: '14px'
                                        }}
                                    />
                                    <p style={{ fontSize: '12px', color: 'var(--text-muted)', marginTop: '8px' }}>
                                        Where to save downloaded videos. Leave empty for default (backend/storage/videos)
                                    </p>
                                </div>
                                <div style={{ marginBottom: '16px' }}>
                                    <label style={{ fontSize: '13px', color: 'var(--text-muted)', display: 'block', marginBottom: '8px' }}>
                                        Backend API URL
                                    </label>
                                    <input
                                        type="text"
                                        value={apiUrlInput}
                                        onChange={e => setApiUrlInput(e.target.value)}
                                        placeholder="http://localhost:8000/api/v1"
                                        style={{
                                            width: '100%',
                                            padding: '12px 16px',
                                            background: 'var(--bg-elevated)',
                                            border: '1px solid var(--border)',
                                            borderRadius: '8px',
                                            color: 'var(--text)',
                                            fontSize: '14px'
                                        }}
                                    />
                                    <p style={{ fontSize: '12px', color: 'var(--text-muted)', marginTop: '8px' }}>
                                        The full API URL including /api/v1 suffix
                                    </p>
                                </div>
                                <div style={{ display: 'flex', gap: '12px', justifyContent: 'flex-end' }}>
                                    <button
                                        onClick={() => setShowSettings(false)}
                                        style={{
                                            padding: '10px 20px',
                                            background: 'var(--bg-elevated)',
                                            border: '1px solid var(--border)',
                                            borderRadius: '8px',
                                            color: 'var(--text)',
                                            cursor: 'pointer'
                                        }}
                                    >
                                        Cancel
                                    </button>
                                    <button
                                        onClick={saveSettings}
                                        style={{
                                            padding: '10px 20px',
                                            background: 'linear-gradient(135deg, var(--accent-purple) 0%, var(--accent-blue) 100%)',
                                            border: 'none',
                                            borderRadius: '8px',
                                            color: 'white',
                                            cursor: 'pointer',
                                            fontWeight: '500'
                                        }}
                                    >
                                        Save
                                    </button>
                                </div>
                            </div>
                        </div>
                    )}

                    {/* Header Section */}
                    <div style={{
                        background: 'linear-gradient(135deg, rgba(168,85,247,0.1) 0%, rgba(59,130,246,0.1) 100%)',
                        borderRadius: '16px',
                        padding: '24px',
                        marginBottom: '20px',
                        border: '1px solid var(--border)'
                    }}>
                        <div style={{ display: 'flex', alignItems: 'center', gap: '12px', marginBottom: '12px' }}>
                            <div style={{
                                width: '40px',
                                height: '40px',
                                borderRadius: '10px',
                                background: 'linear-gradient(135deg, var(--accent-purple) 0%, var(--accent-blue) 100%)',
                                display: 'flex',
                                alignItems: 'center',
                                justifyContent: 'center'
                            }}>
                                <Icons.Brain />
                            </div>
                            <div style={{ flex: 1 }}>
                                <h2 style={{ fontSize: '20px', fontWeight: '600' }}>AI Video Analysis</h2>
                                <p style={{ fontSize: '13px', color: 'var(--text-muted)' }}>
                                    Analyze videos for viral clips, hooks, and engagement insights
                                </p>
                            </div>
                            <div style={{ display: 'flex', alignItems: 'center', gap: '12px' }}>
                                {/* Connection Status */}
                                <div style={{
                                    display: 'flex',
                                    alignItems: 'center',
                                    gap: '6px',
                                    padding: '6px 12px',
                                    background: 'var(--bg-elevated)',
                                    borderRadius: '8px',
                                    fontSize: '12px'
                                }}>
                                    <div style={{
                                        width: '8px',
                                        height: '8px',
                                        borderRadius: '50%',
                                        background: connectionStatus === 'connected' ? 'var(--accent-green)' :
                                                   connectionStatus === 'checking' ? 'var(--accent-yellow)' : 'var(--accent-red)'
                                    }} />
                                    <span style={{ color: 'var(--text-muted)' }}>
                                        {connectionStatus === 'connected' ? 'Connected' :
                                         connectionStatus === 'checking' ? 'Checking...' : 'Disconnected'}
                                    </span>
                                </div>
                                {/* Settings Button */}
                                <button
                                    onClick={() => {
                                        setApiUrlInput(apiBase);
                                        setDownloadDirInput(downloadDir);
                                        setShowSettings(true);
                                    }}
                                    style={{
                                        padding: '8px',
                                        background: 'var(--bg-elevated)',
                                        border: '1px solid var(--border)',
                                        borderRadius: '8px',
                                        color: 'var(--text-muted)',
                                        cursor: 'pointer',
                                        display: 'flex',
                                        alignItems: 'center',
                                        justifyContent: 'center'
                                    }}
                                    title="API Settings"
                                >
                                    <Icons.Settings />
                                </button>
                            </div>
                        </div>
                    </div>

                    {/* Connection Warning */}
                    {connectionStatus === 'disconnected' && (
                        <div style={{
                            background: 'rgba(251,191,36,0.1)',
                            border: '1px solid var(--accent-yellow)',
                            borderRadius: '12px',
                            padding: '16px',
                            marginBottom: '20px'
                        }}>
                            <div style={{ display: 'flex', alignItems: 'flex-start', gap: '12px' }}>
                                <Icons.AlertCircle />
                                <div>
                                    <div style={{ fontWeight: '500', marginBottom: '4px' }}>Backend Not Reachable</div>
                                    <p style={{ fontSize: '13px', color: 'var(--text-muted)', margin: 0 }}>
                                        Unable to connect to the backend at <code style={{ background: 'var(--bg-elevated)', padding: '2px 6px', borderRadius: '4px' }}>{apiBase.replace(/\/api\/v1\/?$/, '')}</code>.
                                        Make sure the backend server is running.
                                    </p>
                                    <p style={{ fontSize: '13px', color: 'var(--text-muted)', margin: '8px 0 0 0' }}>
                                        Start the backend: <code style={{ background: 'var(--bg-elevated)', padding: '2px 6px', borderRadius: '4px' }}>cd backend && uvicorn app.main:app --reload</code>
                                    </p>
                                </div>
                            </div>
                        </div>
                    )}

                    {/* Error Display */}
                    {error && (
                        <div style={{
                            background: 'rgba(239,68,68,0.1)',
                            border: '1px solid var(--accent-red)',
                            borderRadius: '12px',
                            padding: '16px',
                            marginBottom: '20px',
                            display: 'flex',
                            alignItems: 'center',
                            gap: '12px'
                        }}>
                            <Icons.AlertCircle />
                            <span>{error}</span>
                            <button onClick={() => setError(null)} style={{
                                marginLeft: 'auto',
                                background: 'none',
                                border: 'none',
                                color: 'var(--text-muted)',
                                cursor: 'pointer'
                            }}>
                                <Icons.X />
                            </button>
                        </div>
                    )}

                    {/* Input Section (show when no video loaded) */}
                    {!videoId && !results && (
                        <div style={{
                            background: 'var(--bg-surface)',
                            borderRadius: '16px',
                            padding: '24px',
                            marginBottom: '20px',
                            border: '1px solid var(--border)'
                        }}>
                            <h3 style={{ fontSize: '16px', fontWeight: '600', marginBottom: '16px', display: 'flex', alignItems: 'center', gap: '8px' }}>
                                <Icons.Upload />
                                Upload or Enter Video URL
                            </h3>

                            {/* URL Input */}
                            <div style={{ marginBottom: '16px' }}>
                                <div style={{ display: 'flex', gap: '12px' }}>
                                    <input
                                        type="text"
                                        value={videoUrl}
                                        onChange={(e) => setVideoUrl(e.target.value)}
                                        placeholder="https://youtube.com/watch?v=... or video URL"
                                        style={{
                                            flex: 1,
                                            padding: '14px 16px',
                                            background: 'var(--bg-elevated)',
                                            border: '1px solid var(--border)',
                                            borderRadius: '10px',
                                            color: 'var(--text-primary)',
                                            fontSize: '14px',
                                            fontFamily: 'var(--font-mono)'
                                        }}
                                    />
                                    <button
                                        onClick={handleUrlSubmit}
                                        disabled={!videoUrl || isLoading}
                                        style={{
                                            padding: '14px 24px',
                                            background: videoUrl && !isLoading ? 'var(--accent-blue)' : 'var(--bg-elevated)',
                                            border: 'none',
                                            borderRadius: '10px',
                                            color: videoUrl && !isLoading ? 'white' : 'var(--text-muted)',
                                            fontSize: '14px',
                                            fontWeight: '500',
                                            cursor: videoUrl && !isLoading ? 'pointer' : 'not-allowed',
                                            display: 'flex',
                                            alignItems: 'center',
                                            gap: '8px'
                                        }}
                                    >
                                        {isLoading ? <Icons.Loader /> : <Icons.Download />}
                                        Download
                                    </button>
                                </div>
                            </div>

                            {/* Divider */}
                            <div style={{
                                display: 'flex',
                                alignItems: 'center',
                                gap: '16px',
                                margin: '20px 0',
                                color: 'var(--text-muted)',
                                fontSize: '13px'
                            }}>
                                <div style={{ flex: 1, height: '1px', background: 'var(--border)' }} />
                                <span>OR</span>
                                <div style={{ flex: 1, height: '1px', background: 'var(--border)' }} />
                            </div>

                            {/* File Upload */}
                            <label style={{
                                display: 'flex',
                                flexDirection: 'column',
                                alignItems: 'center',
                                padding: '40px',
                                background: 'var(--bg-elevated)',
                                border: '2px dashed var(--border)',
                                borderRadius: '12px',
                                cursor: 'pointer',
                                transition: 'all 0.2s'
                            }}>
                                <Icons.Upload />
                                <span style={{ marginTop: '12px', fontSize: '14px', color: 'var(--text-secondary)' }}>
                                    {videoFile ? videoFile.name : 'Click to upload video file'}
                                </span>
                                <span style={{ marginTop: '4px', fontSize: '12px', color: 'var(--text-muted)' }}>
                                    MP4, WebM, MKV up to 2GB
                                </span>
                                <input
                                    type="file"
                                    accept="video/*"
                                    onChange={handleFileUpload}
                                    style={{ display: 'none' }}
                                />
                            </label>
                        </div>
                    )}

                    {/* Video Ready - Start Analysis */}
                    {videoId && !jobId && !results && (
                        <div style={{
                            background: 'var(--bg-surface)',
                            borderRadius: '16px',
                            padding: '24px',
                            marginBottom: '20px',
                            border: '1px solid var(--border)',
                            textAlign: 'center'
                        }}>
                            <div style={{
                                width: '60px',
                                height: '60px',
                                borderRadius: '50%',
                                background: 'rgba(34,197,94,0.15)',
                                display: 'flex',
                                alignItems: 'center',
                                justifyContent: 'center',
                                margin: '0 auto 16px'
                            }}>
                                <Icons.Check />
                            </div>
                            <h3 style={{ fontSize: '18px', fontWeight: '600', marginBottom: '8px' }}>
                                Video Ready for Analysis
                            </h3>
                            <p style={{ fontSize: '14px', color: 'var(--text-muted)', marginBottom: '24px' }}>
                                Your video has been processed. Start AI analysis to find viral clips.
                            </p>
                            <button
                                onClick={() => startAnalysisForVideo(videoId)}
                                disabled={isLoading}
                                style={{
                                    padding: '16px 32px',
                                    background: 'linear-gradient(135deg, var(--accent-purple) 0%, var(--accent-blue) 100%)',
                                    border: 'none',
                                    borderRadius: '12px',
                                    color: 'white',
                                    fontSize: '16px',
                                    fontWeight: '600',
                                    cursor: 'pointer',
                                    display: 'inline-flex',
                                    alignItems: 'center',
                                    gap: '8px',
                                    boxShadow: '0 4px 20px rgba(168,85,247,0.3)'
                                }}
                            >
                                <Icons.Wand />
                                Start AI Analysis
                            </button>
                        </div>
                    )}

                    {/* Analysis Progress */}
                    {analysisStatus && analysisStatus !== 'completed' && !results && (
                        <div style={{
                            background: 'var(--bg-surface)',
                            borderRadius: '16px',
                            padding: '24px',
                            marginBottom: '20px',
                            border: '1px solid var(--border)'
                        }}>
                            <h3 style={{ fontSize: '16px', fontWeight: '600', marginBottom: '16px', display: 'flex', alignItems: 'center', gap: '8px' }}>
                                <Icons.Loader />
                                Analyzing Video...
                            </h3>

                            <div style={{
                                background: 'var(--bg-elevated)',
                                borderRadius: '8px',
                                height: '8px',
                                overflow: 'hidden',
                                marginBottom: '12px'
                            }}>
                                <div style={{
                                    width: `${analysisProgress}%`,
                                    height: '100%',
                                    background: 'linear-gradient(90deg, var(--accent-purple), var(--accent-blue))',
                                    transition: 'width 0.3s ease'
                                }} />
                            </div>

                            <div style={{ display: 'flex', justifyContent: 'space-between', fontSize: '13px' }}>
                                <span style={{ color: 'var(--text-muted)' }}>
                                    {analysisStatus.replace(/_/g, ' ').replace(/\b\w/g, l => l.toUpperCase())}
                                </span>
                                <span style={{ color: 'var(--text-secondary)' }}>{Math.round(analysisProgress)}%</span>
                            </div>
                        </div>
                    )}

                    {/* Results */}
                    {results && (
                        <div>
                            {/* Summary Cards */}
                            <div style={{
                                display: 'grid',
                                gridTemplateColumns: 'repeat(auto-fit, minmax(200px, 1fr))',
                                gap: '16px',
                                marginBottom: '20px'
                            }}>
                                {[
                                    { label: 'Clips Found', value: results.clips?.length || 0, icon: Icons.Scissors, color: 'var(--accent-purple)' },
                                    { label: 'Duration', value: formatDuration(results.job?.total_duration || 0), icon: Icons.Clock, color: 'var(--accent-blue)' },
                                    { label: 'Speakers', value: results.job?.speaker_count || 1, icon: Icons.Users, color: 'var(--accent-cyan)' },
                                    { label: 'Scenes', value: results.job?.scene_count || 0, icon: Icons.Layers, color: 'var(--accent-green)' },
                                ].map((stat, i) => (
                                    <div key={i} style={{
                                        background: 'var(--bg-surface)',
                                        borderRadius: '12px',
                                        padding: '20px',
                                        border: '1px solid var(--border)'
                                    }}>
                                        <div style={{ display: 'flex', alignItems: 'center', gap: '10px', marginBottom: '8px' }}>
                                            <div style={{ color: stat.color }}><stat.icon /></div>
                                            <span style={{ fontSize: '13px', color: 'var(--text-muted)' }}>{stat.label}</span>
                                        </div>
                                        <div style={{ fontSize: '24px', fontWeight: '700' }}>{stat.value}</div>
                                    </div>
                                ))}
                            </div>

                            {/* Suggested Clips */}
                            {results.clips && results.clips.length > 0 && (
                                <div style={{
                                    background: 'var(--bg-surface)',
                                    borderRadius: '16px',
                                    padding: '24px',
                                    marginBottom: '20px',
                                    border: '1px solid var(--border)'
                                }}>
                                    <h3 style={{ fontSize: '18px', fontWeight: '600', marginBottom: '16px', display: 'flex', alignItems: 'center', gap: '8px' }}>
                                        <Icons.TrendingUp />
                                        Suggested Viral Clips
                                    </h3>

                                    <div style={{ display: 'flex', flexDirection: 'column', gap: '12px' }}>
                                        {results.clips.map((clip, index) => (
                                            <div key={clip.id} style={{
                                                background: 'var(--bg-elevated)',
                                                borderRadius: '12px',
                                                padding: '16px',
                                                border: '1px solid var(--border)'
                                            }}>
                                                <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'start', marginBottom: '12px' }}>
                                                    <div>
                                                        <div style={{ display: 'flex', alignItems: 'center', gap: '8px', marginBottom: '4px' }}>
                                                            <span style={{
                                                                width: '24px',
                                                                height: '24px',
                                                                borderRadius: '50%',
                                                                background: 'var(--accent-purple)',
                                                                display: 'flex',
                                                                alignItems: 'center',
                                                                justifyContent: 'center',
                                                                fontSize: '12px',
                                                                fontWeight: '600'
                                                            }}>
                                                                {index + 1}
                                                            </span>
                                                            <h4 style={{ fontSize: '15px', fontWeight: '600' }}>
                                                                {clip.title || `Clip ${index + 1}`}
                                                            </h4>
                                                        </div>
                                                        <p style={{ fontSize: '13px', color: 'var(--text-muted)' }}>
                                                            {formatDuration(clip.start_time)} - {formatDuration(clip.end_time)} ({formatDuration(clip.duration)})
                                                        </p>
                                                    </div>
                                                    <div style={{ textAlign: 'right' }}>
                                                        <div style={{
                                                            fontSize: '24px',
                                                            fontWeight: '700',
                                                            color: clip.virality_score >= 70 ? 'var(--accent-green)' : clip.virality_score >= 50 ? 'var(--accent-yellow)' : 'var(--text-secondary)'
                                                        }}>
                                                            {Math.round(clip.virality_score)}
                                                        </div>
                                                        <div style={{ fontSize: '11px', color: 'var(--text-muted)' }}>Virality Score</div>
                                                    </div>
                                                </div>

                                                {/* Score Breakdown */}
                                                <div style={{
                                                    display: 'grid',
                                                    gridTemplateColumns: 'repeat(5, 1fr)',
                                                    gap: '8px',
                                                    marginBottom: '12px'
                                                }}>
                                                    {[
                                                        { label: 'Emotion', value: clip.emotional_resonance },
                                                        { label: 'Share', value: clip.shareability },
                                                        { label: 'Unique', value: clip.uniqueness },
                                                        { label: 'Hook', value: clip.hook_strength },
                                                        { label: 'Quality', value: clip.production_quality },
                                                    ].map(score => (
                                                        <div key={score.label} style={{ textAlign: 'center' }}>
                                                            <div style={{ fontSize: '14px', fontWeight: '600' }}>{Math.round(score.value)}</div>
                                                            <div style={{ fontSize: '10px', color: 'var(--text-muted)' }}>{score.label}</div>
                                                        </div>
                                                    ))}
                                                </div>

                                                {/* Transcript excerpt */}
                                                {clip.transcript_excerpt && (
                                                    <p style={{
                                                        fontSize: '13px',
                                                        color: 'var(--text-secondary)',
                                                        fontStyle: 'italic',
                                                        marginBottom: '12px',
                                                        padding: '12px',
                                                        background: 'var(--bg-base)',
                                                        borderRadius: '8px',
                                                        borderLeft: '3px solid var(--accent-purple)'
                                                    }}>
                                                        "{clip.transcript_excerpt.slice(0, 200)}..."
                                                    </p>
                                                )}

                                                <div style={{ display: 'flex', gap: '8px', flexWrap: 'wrap' }}>
                                                    <button
                                                        onClick={() => setExportingClip(clip)}
                                                        style={{
                                                            padding: '10px 16px',
                                                            background: 'linear-gradient(135deg, var(--accent-purple) 0%, var(--accent-blue) 100%)',
                                                            border: 'none',
                                                            borderRadius: '8px',
                                                            color: 'white',
                                                            fontSize: '13px',
                                                            fontWeight: '500',
                                                            cursor: 'pointer',
                                                            display: 'flex',
                                                            alignItems: 'center',
                                                            gap: '6px'
                                                        }}
                                                    >
                                                        <Icons.Download />
                                                        Export
                                                    </button>
                                                    <button
                                                        onClick={() => exportClip(clip.id)}
                                                        style={{
                                                            padding: '10px 16px',
                                                            background: 'var(--bg-elevated)',
                                                            border: '1px solid var(--border)',
                                                            borderRadius: '8px',
                                                            color: 'var(--text-secondary)',
                                                            fontSize: '13px',
                                                            cursor: 'pointer',
                                                            display: 'flex',
                                                            alignItems: 'center',
                                                            gap: '6px'
                                                        }}
                                                    >
                                                        <Icons.Zap />
                                                        Quick
                                                    </button>
                                                    <button
                                                        onClick={() => setShowReframe(clip.id)}
                                                        style={{
                                                            padding: '10px 16px',
                                                            background: 'var(--bg-elevated)',
                                                            border: '1px solid var(--border)',
                                                            borderRadius: '8px',
                                                            color: 'var(--text-secondary)',
                                                            fontSize: '13px',
                                                            cursor: 'pointer',
                                                            display: 'flex',
                                                            alignItems: 'center',
                                                            gap: '6px'
                                                        }}
                                                    >
                                                        <Icons.Crop />
                                                        Reframe
                                                    </button>
                                                    <button
                                                        onClick={() => setShowThumbnails(clip.id)}
                                                        style={{
                                                            padding: '10px 16px',
                                                            background: 'var(--bg-elevated)',
                                                            border: '1px solid var(--border)',
                                                            borderRadius: '8px',
                                                            color: 'var(--text-secondary)',
                                                            fontSize: '13px',
                                                            cursor: 'pointer',
                                                            display: 'flex',
                                                            alignItems: 'center',
                                                            gap: '6px'
                                                        }}
                                                    >
                                                        <Icons.Image />
                                                        Thumbnails
                                                    </button>
                                                    {clip.exported && clip.export_path && (
                                                        <button
                                                            onClick={() => window.open(`${apiBase}/clips/${clip.id}/download`, '_blank')}
                                                            style={{
                                                                padding: '10px 16px',
                                                                background: 'var(--accent-green)',
                                                                border: 'none',
                                                                borderRadius: '8px',
                                                                color: 'white',
                                                                fontSize: '13px',
                                                                fontWeight: '500',
                                                                cursor: 'pointer',
                                                                display: 'flex',
                                                                alignItems: 'center',
                                                                gap: '6px'
                                                            }}
                                                        >
                                                            <Icons.FileDown />
                                                            Open File
                                                        </button>
                                                    )}
                                                </div>

                                                {/* Reframe Panel */}
                                                {showReframe === clip.id && (
                                                    <div style={{ marginTop: '12px' }}>
                                                        <ReframePanel
                                                            clipId={clip.id}
                                                            onReframeComplete={() => setShowReframe(null)}
                                                            onClose={() => setShowReframe(null)}
                                                        />
                                                    </div>
                                                )}

                                                {/* Thumbnail Gallery */}
                                                {showThumbnails === clip.id && (
                                                    <div style={{ marginTop: '12px' }}>
                                                        <ThumbnailGallery
                                                            clipId={clip.id}
                                                            onSelect={() => {}}
                                                            onClose={() => setShowThumbnails(null)}
                                                        />
                                                    </div>
                                                )}
                                            </div>
                                        ))}
                                    </div>
                                </div>
                            )}

                            {/* Transcript */}
                            {results.transcription && (
                                <div style={{
                                    background: 'var(--bg-surface)',
                                    borderRadius: '16px',
                                    padding: '24px',
                                    marginBottom: '20px',
                                    border: '1px solid var(--border)'
                                }}>
                                    <h3 style={{ fontSize: '18px', fontWeight: '600', marginBottom: '16px', display: 'flex', alignItems: 'center', gap: '8px' }}>
                                        <Icons.FileText />
                                        Transcript
                                        <span style={{ fontSize: '13px', fontWeight: '400', color: 'var(--text-muted)' }}>
                                            ({results.transcription.word_count} words)
                                        </span>
                                    </h3>
                                    <div style={{
                                        maxHeight: '300px',
                                        overflow: 'auto',
                                        padding: '16px',
                                        background: 'var(--bg-elevated)',
                                        borderRadius: '12px',
                                        fontSize: '14px',
                                        lineHeight: '1.8',
                                        color: 'var(--text-secondary)'
                                    }}>
                                        {results.transcription.full_text}
                                    </div>
                                </div>
                            )}

                            {/* New Analysis Button */}
                            <div style={{ textAlign: 'center', marginTop: '24px' }}>
                                <button
                                    onClick={resetState}
                                    style={{
                                        padding: '14px 28px',
                                        background: 'var(--bg-elevated)',
                                        border: '1px solid var(--border)',
                                        borderRadius: '10px',
                                        color: 'var(--text-secondary)',
                                        fontSize: '14px',
                                        fontWeight: '500',
                                        cursor: 'pointer',
                                        display: 'inline-flex',
                                        alignItems: 'center',
                                        gap: '8px'
                                    }}
                                >
                                    <Icons.Plus />
                                    Analyze Another Video
                                </button>
                            </div>
                        </div>
                    )}

                    {/* Export Options Modal */}
                    {exportingClip && (
                        <ExportOptionsModal
                            clip={exportingClip}
                            onExport={(result) => {
                                // Update the clip in results to show "Open File" button
                                if (results && results.clips) {
                                    setResults({
                                        ...results,
                                        clips: results.clips.map(c =>
                                            c.id === result.id ? { ...c, exported: true, export_path: result.export_path } : c
                                        )
                                    });
                                }
                                // Open the file
                                window.open(`${apiBase}/clips/${result.id}/download`, '_blank');
                            }}
                            onClose={() => setExportingClip(null)}
                        />
                    )}
                </div>
            );
        };

        // Main App
        const App = () => {
            const [activeTab, setActiveTab] = useState('extract');
            const [url, setUrl] = useState('');
            const [presets, setPresets] = useState(() => {
                const saved = localStorage.getItem('vep-presets');
                return saved ? JSON.parse(saved) : defaultPresets;
            });
            const [selectedPreset, setSelectedPreset] = useState(null);
            const [extraOptions, setExtraOptions] = useState({});
            const [copied, setCopied] = useState(false);
            const [toast, setToast] = useState(null);
            const [editingPreset, setEditingPreset] = useState(null);
            const [history, setHistory] = useState(() => {
                const saved = localStorage.getItem('vep-history');
                return saved ? JSON.parse(saved) : [];
            });

            // Save presets to localStorage
            useEffect(() => {
                localStorage.setItem('vep-presets', JSON.stringify(presets));
            }, [presets]);

            // Save history to localStorage
            useEffect(() => {
                localStorage.setItem('vep-history', JSON.stringify(history));
            }, [history]);

            // Auto-select default preset
            useEffect(() => {
                if (!selectedPreset) {
                    const defaultPreset = presets.find(p => p.isDefault) || presets[0];
                    setSelectedPreset(defaultPreset);
                }
            }, [presets, selectedPreset]);

            const platform = useMemo(() => detectPlatform(url), [url]);
            const urlType = useMemo(() => detectUrlType(url), [url]);
            const command = useMemo(() => {
                if (!url || !selectedPreset) return '';
                return generateCommand(url, selectedPreset, extraOptions);
            }, [url, selectedPreset, extraOptions]);

            const handleCopy = useCallback(() => {
                if (!command) return;
                navigator.clipboard.writeText(command);
                setCopied(true);
                setTimeout(() => setCopied(false), 2000);
                
                // Add to history
                const historyItem = {
                    command,
                    url,
                    preset: selectedPreset.name,
                    timestamp: Date.now()
                };
                setHistory(prev => [historyItem, ...prev.slice(0, 49)]);
                setToast({ message: 'Command copied to clipboard!', type: 'success' });
            }, [command, url, selectedPreset]);

            const handleQuickGenerate = useCallback(() => {
                if (!url) {
                    setToast({ message: 'Please enter a URL first', type: 'error' });
                    return;
                }
                const defaultPreset = presets.find(p => p.isDefault) || presets[0];
                setSelectedPreset(defaultPreset);
                setTimeout(() => {
                    const cmd = generateCommand(url, defaultPreset, extraOptions);
                    navigator.clipboard.writeText(cmd);
                    setToast({ message: 'Quick command copied!', type: 'success' });
                    
                    const historyItem = {
                        command: cmd,
                        url,
                        preset: defaultPreset.name,
                        timestamp: Date.now()
                    };
                    setHistory(prev => [historyItem, ...prev.slice(0, 49)]);
                }, 100);
            }, [url, presets, extraOptions]);

            const handleSavePreset = useCallback((updatedPreset) => {
                setPresets(prev => prev.map(p => p.id === updatedPreset.id ? updatedPreset : p));
                if (selectedPreset?.id === updatedPreset.id) {
                    setSelectedPreset(updatedPreset);
                }
                setToast({ message: 'Preset saved!', type: 'success' });
            }, [selectedPreset]);

            const handleUseHistoryCommand = useCallback((item) => {
                setUrl(item.url);
                setActiveTab('extract');
                navigator.clipboard.writeText(item.command);
                setToast({ message: 'Command copied!', type: 'success' });
            }, []);

            return (
                <div className="app">
                    <Header activeTab={activeTab} setActiveTab={setActiveTab} />
                    
                    {activeTab === 'extract' && (
                        <div className="animate-in">
                            <URLInput url={url} setUrl={setUrl} platform={platform} urlType={urlType} />
                            
                            {/* Quick Generate */}
                            <div style={{
                                background: 'var(--bg-surface)',
                                borderRadius: '16px',
                                padding: '20px',
                                marginBottom: '20px',
                                border: '1px solid var(--border)',
                                display: 'flex',
                                alignItems: 'center',
                                justifyContent: 'space-between'
                            }}>
                                <div>
                                    <h3 style={{ fontSize: '16px', fontWeight: '600', marginBottom: '4px' }}>
                                        Ready for a quick download?
                                    </h3>
                                    <p style={{ fontSize: '13px', color: 'var(--text-muted)' }}>
                                        Use your saved default preset for a one-click command.
                                    </p>
                                </div>
                                <button
                                    onClick={handleQuickGenerate}
                                    style={{
                                        padding: '12px 24px',
                                        background: 'linear-gradient(135deg, var(--accent-blue) 0%, var(--accent-cyan) 100%)',
                                        border: 'none',
                                        borderRadius: '10px',
                                        color: 'white',
                                        fontSize: '14px',
                                        fontWeight: '600',
                                        cursor: 'pointer',
                                        display: 'flex',
                                        alignItems: 'center',
                                        gap: '8px',
                                        boxShadow: '0 4px 20px rgba(59,130,246,0.3)'
                                    }}
                                >
                                    <Icons.Zap /> Quick Generate
                                </button>
                            </div>
                            
                            {/* Preset Selection */}
                            <div style={{
                                background: 'var(--bg-surface)',
                                borderRadius: '16px',
                                padding: '24px',
                                marginBottom: '20px',
                                border: '1px solid var(--border)'
                            }}>
                                <div style={{
                                    display: 'flex',
                                    alignItems: 'center',
                                    gap: '10px',
                                    marginBottom: '16px'
                                }}>
                                    <Icons.Layers />
                                    <h2 style={{ fontSize: '18px', fontWeight: '600' }}>Select Preset</h2>
                                </div>
                                
                                <div style={{
                                    display: 'grid',
                                    gridTemplateColumns: 'repeat(auto-fill, minmax(280px, 1fr))',
                                    gap: '12px'
                                }}>
                                    {presets.map(preset => (
                                        <div
                                            key={preset.id}
                                            onClick={() => setSelectedPreset(preset)}
                                            style={{
                                                padding: '14px',
                                                background: selectedPreset?.id === preset.id ? 'rgba(59,130,246,0.1)' : 'var(--bg-elevated)',
                                                border: selectedPreset?.id === preset.id ? '1px solid var(--accent-blue)' : '1px solid var(--border)',
                                                borderRadius: '10px',
                                                cursor: 'pointer',
                                                transition: 'all 0.2s'
                                            }}
                                        >
                                            <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center' }}>
                                                <span style={{ fontWeight: '500', fontSize: '14px' }}>{preset.name}</span>
                                                <div style={{ display: 'flex', gap: '6px' }}>
                                                    <span style={{
                                                        padding: '2px 8px',
                                                        background: preset.extractAudio ? 'rgba(168,85,247,0.15)' : 'rgba(34,197,94,0.15)',
                                                        color: preset.extractAudio ? 'var(--accent-purple)' : 'var(--accent-green)',
                                                        borderRadius: '4px',
                                                        fontSize: '11px'
                                                    }}>
                                                        {preset.extractAudio ? 'Audio' : preset.quality + 'p'}
                                                    </span>
                                                    {preset.isDefault && (
                                                        <span style={{ color: 'var(--accent-yellow)' }}><Icons.Star /></span>
                                                    )}
                                                </div>
                                            </div>
                                        </div>
                                    ))}
                                </div>
                            </div>
                            
                            <ExtraOptions options={extraOptions} setOptions={setExtraOptions} />
                            
                            <CommandPreview command={command} onCopy={handleCopy} copied={copied} />
                        </div>
                    )}
                    
                    {activeTab === 'presets' && (
                        <PresetsPage
                            presets={presets}
                            setPresets={setPresets}
                            onEditPreset={setEditingPreset}
                        />
                    )}
                    
                    {activeTab === 'aianalysis' && <AIAnalysisPage />}

                    {activeTab === 'profeatures' && <ProFeaturesPage />}

                    {activeTab === 'converter' && <TimestampConverter />}

                    {activeTab === 'history' && (
                        <HistoryPage
                            history={history}
                            onUseCommand={handleUseHistoryCommand}
                            onClearHistory={() => setHistory([])}
                        />
                    )}
                    
                    {editingPreset && (
                        <PresetEditor
                            preset={editingPreset}
                            onSave={handleSavePreset}
                            onClose={() => setEditingPreset(null)}
                        />
                    )}
                    
                    {toast && (
                        <Toast
                            message={toast.message}
                            type={toast.type}
                            onClose={() => setToast(null)}
                        />
                    )}
                </div>
            );
        };

        ReactDOM.render(<App />, document.getElementById('root'));
    </script>
</body>
</html>
